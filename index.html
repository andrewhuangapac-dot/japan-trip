<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‰∫¨Èò™Á•û‰∫≤Â≠êÊ∏∏ (v27)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>

    <style>
        body, html { height: 100%; margin: 0; overflow: hidden; background-color: #fff7ed; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        #app { height: 100%; display: flex; flex-direction: column; }
        .scroll-container { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; position: relative; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        #map { height: 100%; width: 100%; z-index: 1; }
        [v-cloak] { display: none; }
        .map-btn { transition: all 0.2s; }
        .map-btn:active { transform: scale(0.95); }
        .vip-badge { background: linear-gradient(135deg, #1f2937 0%, #000000 100%); color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; margin-left: 5px; box-shadow: 0 2px 4px rgba(0,0,0, 0.2); }
        .hotel-badge { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; margin-left: 5px; }
        .transport-badge { background: #e0f2fe; color: #0369a1; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; border: 1px solid #bae6fd; }
        .food-card { background-color: #fffbeb; border: 1px solid #fed7aa; border-radius: 0.75rem; padding: 0.75rem; margin-top: 0.75rem; box-shadow: 0 2px 5px rgba(251, 146, 60, 0.05); }
        .shop-card { background-color: #fff1f2; border: 1px solid #fda4af; border-radius: 0.75rem; padding: 0.75rem; margin-top: 0.5rem; color: #9f1239; }
        .transport-detail { background-color: #f8fafc; border-left: 3px solid #64748b; padding: 0.75rem; margin-top: 0.5rem; border-radius: 0 0.5rem 0.5rem 0; }
        .jp-text { font-family: "Hiragino Sans", "Yu Gothic", sans-serif; }
        
        /* ÈíàÂØπÂ§ßÈæÑÂ∞èÂ≠©ÁöÑÁâπÂà´Ê†∑Âºè */
        .game-tag { background: #ef4444; color: white; font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: bold; margin-left: 4px; }
    </style>
</head>
<body>

<div id="app" v-cloak class="max-w-md mx-auto bg-white shadow-2xl relative">
    
    <header class="flex-none bg-gradient-to-r from-orange-600 to-red-600 text-white p-5 pb-4 rounded-b-[2rem] shadow-xl z-20">
        <div class="flex justify-between items-center mb-4">
            <div>
                <h1 class="text-xl font-bold tracking-wide">‰∫¨Èò™Á•û‰∫≤Â≠êÊ∏∏ üéÆ</h1>
                <p class="text-orange-100 text-xs mt-1 font-medium">v27: Â¢ûÂä†‰ªªÂ§©Â†Ç/Pokemon/Êâ≠Ëõã</p>
            </div>
            <button @click="resetData" class="text-xs bg-white/20 border border-white/30 px-3 py-1.5 rounded-full hover:bg-white/30 transition backdrop-blur-sm">ÈáçÁΩÆ</button>
        </div>
        <div class="flex space-x-2 overflow-x-auto no-scrollbar pb-1">
            <button v-for="(day, index) in days" :key="index" @click="changeDay(index)"
                :class="currentDay === index ? 'bg-white text-orange-700 font-bold shadow-lg scale-105 ring-2 ring-white/50' : 'bg-orange-800/40 text-orange-100 hover:bg-orange-700/60'"
                class="px-3 py-2 rounded-xl text-xs whitespace-nowrap transition-all flex-shrink-0 mb-2 flex flex-col items-center min-w-[4.5rem]">
                <span>{{ day.date }}</span>
                <span class="text-[10px] opacity-80 mt-0.5">{{ day.weather.temp_high }}¬∞</span>
            </button>
        </div>
    </header>

    <main class="scroll-container bg-stone-50">
        
        <div v-show="currentView === 'list'" class="pb-24 px-4 pt-4">
            
            <div class="mb-5 bg-white rounded-2xl p-4 shadow-sm border border-stone-200 flex items-center justify-between">
                <div>
                    <h2 class="text-lg font-bold text-stone-800">{{ days[currentDay].name }}</h2>
                    <div class="flex items-center mt-1 text-sm font-medium" :class="days[currentDay].weather.color">
                        <i :class="days[currentDay].weather.icon" class="mr-2 text-lg"></i>
                        <span>{{ days[currentDay].weather.status }}</span>
                    </div>
                </div>
            </div>

            <div class="space-y-5">
                <div v-for="item in sortedActivities" :key="item.id" class="relative pl-6 border-l-[3px] border-stone-200 last:border-0">
                    <div class="absolute -left-[10px] top-5 w-5 h-5 rounded-full border-4 border-white shadow-sm transition-colors duration-300"
                         :class="getIconColor(item)"></div>
                    
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-stone-100 hover:shadow-md transition-all duration-300 group">
                        <div class="flex justify-between items-start">
                            <div class="flex-1 mr-3">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="bg-stone-100 text-stone-600 text-[11px] font-bold px-2 py-0.5 rounded" :class="{'text-red-600 bg-red-50': isKeyTime(item.time)}">{{ item.time }}</span>
                                    <span v-if="item.isHotel" class="hotel-badge"><i class="fas fa-bed mr-1"></i>È•≠Â∫ó</span>
                                    <span v-if="item.recommend" class="vip-badge"><i class="fab fa-uber mr-1"></i>Uber</span>
                                    <span v-if="item.isGame" class="game-tag"><i class="fas fa-gamepad mr-1"></i>ÂøÖÂéª</span>
                                </div>
                                <h3 class="font-bold text-stone-800 text-[15px] leading-tight jp-text">{{ item.location }}</h3>
                                <p class="text-stone-600 text-sm mt-1 font-medium jp-text">{{ item.action }}</p>
                                
                                <div v-if="item.transport_detail" class="transport-detail">
                                    <p class="text-xs text-slate-800 font-bold mb-1"><i class="fas fa-info-circle mr-1 text-slate-500"></i>ÊåáÂºïÔºö</p>
                                    <p class="text-[11px] text-slate-600 leading-relaxed whitespace-pre-line jp-text">{{ item.transport_detail }}</p>
                                </div>

                                <div v-if="item.note && !item.transport_detail" class="mt-2 text-xs text-stone-500 bg-stone-50 p-2 rounded-lg">
                                    <i class="fas fa-info-circle mr-1 text-stone-400"></i>{{ item.note }}
                                </div>

                                <div v-if="item.foodOptions" class="food-card">
                                    <p class="text-xs font-bold text-orange-700 mb-2 border-b border-orange-100 pb-1">
                                        <i class="fas fa-utensils mr-1"></i>È§êÈ•ÆÊé®Ëçê
                                    </p>
                                    <div class="space-y-2">
                                        <div v-for="(food, fIdx) in item.foodOptions" :key="fIdx" class="flex items-center justify-between">
                                            <div>
                                                <p class="text-xs font-bold text-gray-800 jp-text">{{ food.name }}</p>
                                                <p class="text-[10px] text-gray-500">{{ food.desc }}</p>
                                            </div>
                                            <a :href="food.link" target="_blank" class="text-orange-500 hover:text-orange-700 ml-2 p-1 bg-orange-50 rounded-lg">
                                                <i class="fas fa-map-marker-alt"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>

                                <div v-if="item.shopping" class="shop-card flex items-center justify-between">
                                    <div>
                                        <p class="text-xs font-bold jp-text"><i class="fas fa-shopping-cart mr-1"></i>{{ item.shopping.name }}</p>
                                        <p class="text-[10px] opacity-80">{{ item.shopping.desc }}</p>
                                    </div>
                                    <a :href="item.shopping.link" target="_blank" class="bg-white text-pink-600 w-6 h-6 flex items-center justify-center rounded-full shadow-sm">
                                        <i class="fas fa-map-pin text-[10px]"></i>
                                    </a>
                                </div>
                            </div>
                            
                            <div class="flex flex-col space-y-3 pt-1">
                                <button v-if="item.link" @click="openSmartMap(item)" 
                                    class="map-btn w-10 h-10 rounded-xl bg-black text-white shadow-gray-400 shadow-md hover:bg-gray-800 flex items-center justify-center">
                                    <i class="fas fa-location-arrow text-sm"></i>
                                </button>
                                <button v-else class="w-10 h-10 rounded-xl bg-stone-100 text-stone-300 flex items-center justify-center cursor-default">
                                    <i class="fas fa-map-marker-alt text-sm"></i>
                                </button>
                                
                                <button @click="editActivity(item)" class="map-btn w-10 h-10 rounded-xl bg-stone-50 text-stone-400 flex items-center justify-center hover:bg-stone-100">
                                    <i class="fas fa-pen text-xs"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-show="currentView === 'map'" class="absolute inset-0 z-0 bg-gray-100 h-full w-full">
            <div id="map"></div>
            <div class="absolute top-4 left-4 z-[500] bg-white/90 backdrop-blur p-3 rounded-xl shadow-lg border border-stone-200">
                <p class="text-xs font-bold text-stone-700 mb-1">Âú∞ÂõæÂõæ‰æã</p>
                <div class="flex items-center gap-2 mb-1"><span class="w-3 h-3 rounded-full bg-purple-500"></span><span class="text-[10px]">È•≠Â∫ó</span></div>
                <div class="flex items-center gap-2 mb-1"><span class="w-3 h-3 rounded-full bg-blue-500"></span><span class="text-[10px]">ÊôØÁÇπ/‰∫§ÈÄö</span></div>
                <div class="flex items-center gap-2 mb-1"><span class="w-3 h-3 rounded-full bg-red-500"></span><span class="text-[10px]">Âä®Êº´/Ê∏∏Êàè</span></div>
                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-orange-500"></span><span class="text-[10px]">È§êÂéÖ</span></div>
            </div>
        </div>
    </main>

    <nav class="flex-none bg-white/95 backdrop-blur border-t border-stone-100 px-6 py-2 flex justify-between items-center z-30 pb-6 pt-3 shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
        <button @click="currentView = 'list'" :class="currentView === 'list' ? 'text-orange-600' : 'text-stone-400'" class="flex flex-col items-center w-16 transition-colors">
            <i class="fas fa-list-ul text-lg mb-1"></i><span class="text-[10px] font-medium">Ë°åÁ®ã</span>
        </button>
        <button @click="openModal()" class="bg-orange-600 text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg shadow-orange-200 -translate-y-5 hover:scale-105 active:scale-95 transition-all">
            <i class="fas fa-plus text-xl"></i>
        </button>
        <button @click="switchMap" :class="currentView === 'map' ? 'text-orange-600' : 'text-stone-400'" class="flex flex-col items-center w-16 transition-colors">
            <i class="fas fa-map-marked-alt text-lg mb-1"></i><span class="text-[10px] font-medium">Âú∞Âõæ</span>
        </button>
    </nav>

    <div v-if="showModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-stone-900/60 p-4 backdrop-blur-sm transition-opacity">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-bounce-up">
            <h2 class="text-lg font-bold mb-4 text-stone-800">{{ isEditing ? 'ÁºñËæëË°åÁ®ã' : 'Êñ∞Â¢ûË°åÁ®ã' }}</h2>
            <div class="space-y-3">
                <div class="flex gap-3">
                    <input type="time" v-model="form.time" class="w-1/3 bg-stone-50 border border-stone-200 rounded-xl p-3 outline-none focus:border-orange-500 transition">
                    <input type="text" v-model="form.location" placeholder="Âú∞ÁÇπ" class="w-2/3 bg-stone-50 border border-stone-200 rounded-xl p-3 outline-none focus:border-orange-500 transition">
                </div>
                <input type="text" v-model="form.action" placeholder="ÂÜÖÂÆπ" class="w-full bg-stone-50 border border-stone-200 rounded-xl p-3 outline-none focus:border-orange-500 transition">
                <input type="text" v-model="form.transport" placeholder="‰∫§ÈÄöÁÆÄËø∞" class="w-full bg-stone-50 border border-stone-200 text-stone-800 rounded-xl p-3 outline-none focus:border-orange-400 placeholder-stone-400 transition">
                <textarea v-model="form.transport_detail" placeholder="ËØ¥Êòé" class="w-full bg-stone-50 border border-stone-200 rounded-xl p-3 h-20 resize-none outline-none focus:border-orange-500 transition"></textarea>
                <input type="text" v-model="form.link" placeholder="Map Link" class="w-full bg-stone-50 border border-stone-200 rounded-xl p-3 text-xs text-stone-500 outline-none focus:border-orange-500 transition">
            </div>
            <div class="flex gap-3 mt-6">
                <button v-if="isEditing" @click="deleteActivity" class="flex-1 bg-red-50 text-red-500 py-3 rounded-xl font-bold hover:bg-red-100 transition">Âà†Èô§</button>
                <button @click="showModal = false" class="flex-1 bg-stone-100 text-stone-500 py-3 rounded-xl font-medium hover:bg-stone-200 transition">ÂèñÊ∂à</button>
                <button @click="saveActivity" class="flex-[2] bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 shadow-lg shadow-orange-200 transition">ÂÇ®Â≠ò</button>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp } = Vue;

    // v27 Data: Optimized for 9 and 12 years old (ACG, Food, No Strollers)
    const detailedData = {
        0: [
            { id: 1, time: '16:50', location: 'ÂÖ≥Ë•øÊú∫Âú∫ T2 (Èñ¢Ë•øÁ©∫Ê∏Ø T2)', action: 'ËΩ¨Êê≠Êé•È©≥Â∑¥Â£´', transport: 'ÂÖçË¥πÂ∑¥Â£´', 
              transport_detail: 'ÂÖ•Â¢ÉÂêéÔºåÊê≠‰πòÂÖçË¥πÊé•È©≥Â∑¥Â£´Á∫¶ 7-10 ÂàÜÈíüÂâçÂæÄ T1/Aeroplaza„ÄÇ',
              link: 'https://www.google.com/maps/search/?api=1&query=Aeroplaza+Kansai+Airport',
              coords: [34.4357, 135.2443] },
            { id: 2, time: '17:35', location: 'ÂÖ≥Ë•øÊú∫Âú∫Á´ô (Èñ¢Ë•øÁ©∫Ê∏ØÈßÖ)', action: 'ÂçóÊµ∑ÁâπÊÄ• Rapi:t Œ±', transport: '17:35 ÂèëËΩ¶ (ÂÖ®ËΩ¶ÊåáÂÆöÂ∏≠)', 
              transport_detail: 'Ê∑±ËìùËâ≤ÂÉèÊú∫Âô®‰∫∫ÁöÑÂàóËΩ¶ (ÈìÅ‰∫∫28Âè∑)ÔºåÂ∞èÂ≠©‰ºöËßâÂæóÂæàÂ∏Ö„ÄÇÁõ¥ËææÈöæÊ≥¢„ÄÇ',
              link: 'https://www.google.com/maps/search/?api=1&query=Nankai+Kansai+Airport+Station',
              coords: [34.4367, 135.2435] },
            { id: 3, time: '18:15', location: 'ÂçóÊµ∑ÈöæÊ≥¢Á´ô (Namba St.)', action: 'Âá∫Á´ôÊ≠•Ë°å', transport: 'Ê≠•Ë°å (Á∫¶10ÂàÜ)', 
              transport_detail: 'ËØ∑Ëµ∞„ÄåÂú∞Èù¢ÈÅìË∑Ø„ÄçÔºåÁªèËøáÂçóÊµ∑ÈÄö (Nankai Dori)ÔºåÁÉ≠Èóπ‰∏îÊúâÈÅÆÈõ®Ê£ö„ÄÇ',
              link: 'https://www.google.com/maps/search/?api=1&query=Namba+Station+Nankai',
              coords: [34.6631, 135.5023] },
            { id: 4, time: '18:30', location: 'Caption by Hyatt', action: 'Check-in', transport: 'Ê≠•Ë°å', isHotel: true, note: 'ÊîæË°åÊùéÔºåÂáÜÂ§áÂá∫Èó®„ÄÇ', 
              link: 'https://www.google.com/maps/search/?api=1&query=Caption+by+Hyatt+Namba+Osaka',
              coords: [34.6655, 135.5065] },
            { id: 5, time: '19:15', location: 'ÈÅìÈ°øÂ†Ä (Dotonbori)', action: 'ÊôöÈ§ê & Â§πÂ®ÉÂ®É', transport: 'Ê≠•Ë°å', note: 'ËøôÈáåÊúâË∂ÖÂ§öÂ§πÂ®ÉÂ®ÉÂ∫ó (GIGO/Round1)„ÄÇ', 
              link: 'https://www.google.com/maps/search/?api=1&query=Dotonbori+Glico+Sign',
              coords: [34.6687, 135.5013],
                foodOptions: [
                    { name: '‰∏ÄÂÖ∞ÊãâÈù¢ (Ichiran)', desc: 'Â∞èÂ≠©ÊåáÂÆöÂøÖÂêÉ', link: 'https://www.google.com/maps/search/?api=1&query=Ichiran+Dotonbori' },
                    { name: 'ÁÉßËÇâÂäõ‰∏∏ (Yakiniku Rikimaru)', desc: 'ÂõΩ‰∫ßÁâõÂêÉÂà∞È•±', link: 'https://www.google.com/maps/search/?api=1&query=Yakiniku+Rikimaru+Namba+Dotonbori' }
                ],
                shopping: { name: 'ÂîêÂêâËØÉÂæ∑Êë©Â§©ËΩÆ (Don Quijote)', desc: 'ÂèØ‰ª•Êê≠Êë©Â§©ËΩÆÁúãÂ§úÊôØ', link: 'https://www.google.com/maps/search/?api=1&query=Don+Quijote+Dotonbori' }
            }
        ],
        1: [
            { id: 7, time: '09:00', location: 'Êó•Êú¨Ê°• ‚Üí Á•ûÊà∑', action: 'ÁßªÂä®', transport: 'Èò™Á•ûÁîµËΩ¶ (Âø´ÈÄüÊÄ•Ë°å)', 
              transport_detail: 'Âà∑ IC Âç°Áõ¥Êé•ËøõÁ´ôÔºåÊê≠ÂæÄ„ÄåÁ•ûÊà∑‰∏âÂÆ´„ÄçÁöÑÂø´ÈÄüÊÄ•Ë°å„ÄÇ',
              link: 'https://www.google.com/maps/search/?api=1&query=Kintetsu+Nippombashi+Station',
              coords: [34.6672, 135.5065] },
            { id: 11, time: '11:30', location: '‰∏âÂÆ´Â∏ÇÂå∫ (Sannomiya)', action: 'Á•ûÊà∑ÁâõÂçàÈ§ê', transport: 'Ê≠•Ë°å', note: '9/12Â≤ÅÂ∞èÂ≠©ÂèØ‰ª•Ëá™Â∑±ÂàáÁâõÊéí‰∫Ü„ÄÇ', 
              link: 'https://www.google.com/maps/search/?api=1&query=Kobe+Sannomiya+Station',
              coords: [34.6930, 135.1915],
                foodOptions: [
                    { name: 'Steakland („Çπ„ÉÜ„Éº„Ç≠„É©„É≥„Éâ)', desc: 'CPÂÄºÈ´òÔºåÂ∏àÂÇÖ‰ºöË°®Êºî', link: 'https://www.google.com/maps/search/?api=1&query=Steakland+Kobekan' },
                    { name: 'Red Rock („É¨„ÉÉ„Éâ„É≠„ÉÉ„ÇØ)', desc: 'Â†ÜÂæóÂÉèÂ±±ÁöÑÁÉ§ÁâõËÇâÈ•≠', link: 'https://www.google.com/maps/search/?api=1&query=Red+Rock+Sannomiya' }
                ]
            },
            { id: 12, time: '14:00', location: '‰∏âÂÆ´ ‚Üí Á•ûÊà∑Ê∏Ø', action: 'ÁßªÂä®', transport: 'Uber / Taxi', recommend: true, 
              transport_detail: 'Áõ¥Êé•ÂâçÂæÄ„ÄåUmie Mosaic„Äç„ÄÇ',
              link: 'https://www.google.com/maps/search/?api=1&query=Kobe+Harborland+umie+Mosaic',
              coords: [34.6795, 135.1843] },
            { id: 13, time: '14:30', location: 'Á•ûÊà∑Ê∏Ø (Mosaic)', action: 'ÈÄõË°ó', transport: 'Ê≠•Ë°å', 
              note: 'ËøôÈáåÊúâË∂ÖÂ§ß Gashapon (Êâ≠ËõãÁôæË¥ß) Âíå Jump Shop„ÄÇ', 
              link: 'https://www.google.com/maps/search/?api=1&query=Mosaic+Kobe',
              coords: [34.6795, 135.1843],
              shopping: { name: 'Gashapon Department Store', desc: 'Mosaic 3F Êâ≠Ëõã‰∏ìÈó®Â∫ó', link: 'https://www.google.com/maps/search/?api=1&query=Gashapon+Department+Store+Kobe' }
            },
            { id: 14, time: '17:30', location: 'Mosaic ‚Üí Â§ßÈò™', action: 'ÂõûÁ®ã', transport: 'Uber -> Èò™Á•ûÁîµËΩ¶', 
              transport_detail: 'ÂèØ‰ª•ÁúãÁ•ûÊà∑Ê∏ØÂ°îÂ§úÊôØÔºåÁÑ∂ÂêéÂõûÂ§ßÈò™„ÄÇ',
              link: 'https://www.google.com/maps/search/?api=1&query=Kobe+Port+Tower',
              coords: [34.6815, 135.1765] },
            { id: 15, time: '19:00', location: 'Êó•Êú¨Ê°• (Nippombashi)', action: 'ÊôöÈ§ê', transport: 'Ê≠•Ë°å',
              coords: [34.6672, 135.5065],
              foodOptions: [
                    { name: 'Â§©Êîø‰πåÈæôÈ∫µ (Tenmasa)', desc: 'Âø´ÈÄü‰æøÂÆúÂ•ΩÂêÉ', link: 'https://www.google.com/maps/search/?api=1&query=Tenmasa+Namba' },
                    { name: 'ÂçÉÊàøÂ§ßÈò™ÁÉß (Chibo)', desc: 'ÁúãÂ∏àÂÇÖÁæé‰πÉÊªãÊãâËä±', link: 'https://www.google.com/maps/search/?api=1&query=Chibo+Dotonbori+Building' }
                ]
            }
        ],
        2: [
            { id: 16, time: '09:30', location: 'ÈªëÈó®Â∏ÇÂú∫ (Kuromon Market)', action: 'Êó©ÂçàÈ§ê', transport: 'Ê≠•Ë°å', note: 'Â∞èÂ≠©Áà±ÂêÉÁöÑÁÉ§ÁâõËÇâ‰∏≤„ÄÅÂ§ßËçâËéì„ÄÅÂìàÂØÜÁìú„ÄÇ', 
              link: 'https://www.google.com/maps/search/?api=1&query=Kuromon+Ichiba+Market',
              coords: [34.6654, 135.5065] },
            { id: 17, time: '11:00', location: 'È•≠Â∫ó ‚Üí Ê∑ÄÂ±ãÊ°•', action: 'ÁßªÂä®Ëá≥‰∫¨ÈÉΩ', transport: 'Uber', recommend: true, 
              transport_detail: 'Ë°åÊùéÂ§öËøòÊòØÂª∫ËÆÆÊê≠ Taxi Âà∞‰∫¨Èò™Ê∑ÄÂ±ãÊ°•Á´ô„ÄÇ',
              link: 'https://www.google.com/maps/search/?api=1&query=Yodoyabashi+Station+Keihan',
              coords: [34.6930, 135.5015] },
            { id: 18, time: '11:30', location: 'Ê∑ÄÂ±ãÊ°• ‚Üí Á•ûÂÆ´‰∏∏Â§™Áî∫', action: '‰∫¨Èò™ÁâπÊÄ•', transport: 'Premium Car', 
              transport_detail: '‚òÖÂº∫ÁÉàÂª∫ËÆÆÂä†Ë¥≠ Premium CarÔºåÂ∫ß‰ΩçÂ§ß„ÄÅÊúâÊ°åÂ≠êÔºåÂ∞èÂ≠©ÂèØ‰ª•Âú®ËΩ¶‰∏äÁé© Switch/ÊâãÊú∫„ÄÇ',
              link: 'https://www.google.com/maps/search/?api=1&query=Jingu-Marutamachi+Station',
              coords: [35.0175, 135.7725] },
            { id: 19, time: '12:30', location: 'Hyatt Place Kyoto', action: 'Check-in', transport: 'Uber', isHotel: true, 
              coords: [35.0163, 135.7592] },
            { id: 20, time: '13:30', location: 'Èî¶Â∏ÇÂú∫ (Nishiki Market)', action: 'Â∞èÂêÉÂçàÈ§ê', transport: 'Uber/Âú∞ÈìÅ', 
              note: 'Á´†È±ºËõã‰∏≤„ÄÅÂè≤Âä™ÊØîËå∂Â±ãÔºå9&12Â≤Å‰ºöÂæàÁà±ËøôÈáå„ÄÇ', 
              link: 'https://www.google.com/maps/search/?api=1&query=Nishiki+Market',
              coords: [35.0050, 135.7630] },
            { id: 21, time: '15:30', location: 'ÂõõÊù°Ê≤≥ÂéüÁî∫ (Nintendo Kyoto)', action: 'ÊúùÂú£ÈááË¥≠', transport: 'Ê≠•Ë°å', isGame: true,
              note: '‚òÖÈáçÁÇπË°åÁ®ãÔºöNintendo Kyoto (È´òÂ≤õÂ±ãT8) + Pokemon Center (SuinaÂÆ§Áî∫)„ÄÇ', 
              link: 'https://www.google.com/maps/search/?api=1&query=Nintendo+Kyoto',
              coords: [35.0038, 135.7695],
              shopping: { name: 'Nintendo Kyoto', desc: 'È´òÂ≤õÂ±ã S.C. T8 7Ê•ºÔºåÂøÖÂéªÔºÅ', link: 'https://www.google.com/maps/search/?api=1&query=Nintendo+Kyoto' } 
            },
            { id: 22, time: '18:00', location: 'ÂõõÊù° / ‰πå‰∏∏', action: 'ÊôöÈ§ê', transport: 'Ê≠•Ë°å', 
              coords: [35.0035, 135.7595],
                foodOptions: [
                    { name: 'Âêç‰ª£ÁÇ∏Áå™Êéí (Katsukura)', desc: 'Ëá™Â∑±Á£®ËäùÈ∫ªÂæàÂ•ΩÁé©', link: 'https://www.google.com/maps/search/?api=1&query=Katsukura+Sanjo+Honten' },
                    { name: 'Shake Shack', desc: 'Â¶ÇÊûúÂ∞èÂ≠©‰∏çÊÉ≥ÂêÉÊó•ÂºèÔºåËøôÈáåÊúâÊ±âÂ†°', link: 'https://www.google.com/maps/search/?api=1&query=Shake+Shack+Kyoto+Shijo+Karasuma' }
                ]
            }
        ],
        3: [
            { id: 23, time: '08:30', location: 'È•≠Â∫ó ‚Üí ‰ºèËßÅÁ®ªËç∑ (Fushimi Inari)', action: 'ÂçÉÊú¨È∏üÂ±Ö', transport: 'Uber', recommend: true, 
              transport_detail: 'ÂÉèÊé¢Èô©‰∏ÄÊ†∑ÁöÑÈ∏üÂ±ÖÈößÈÅìÔºå9&12Â≤Å‰ΩìÂäõÂ•ΩÔºåÂèØ‰ª•ÊåëÊàòËµ∞Âà∞ÂçäÂ±±ËÖ∞„ÄÇ',
              link: 'https://www.google.com/maps/search/?api=1&query=Fushimi+Inari+Taisha',
              coords: [34.9671, 135.7726] },
            { id: 24, time: '10:30', location: '‰ºèËßÅÁ®ªËç∑ ‚Üí Ê∏ÖÊ∞¥ÂØ∫', action: 'ÁßªÂä®', transport: 'Uber', recommend: true, 
              transport_detail: 'Áõ¥Ëææ„ÄåÊ∏ÖÊ∞¥ÈÅì„Äç„ÄÇ',
              coords: [34.9949, 135.7850] },
            { id: 25, time: '12:00', location: 'Ê∏ÖÊ∞¥ÂØ∫Âë®Ëæπ', action: 'ÂçàÈ§ê', transport: 'Ê≠•Ë°å', 
              coords: [34.9960, 135.7830],
                foodOptions: [
                    { name: 'Ê∏ÖÊ∞¥È°∫Ê≠£ (Junsei)', desc: 'Ê±§Ë±ÜËÖê', link: 'https://www.google.com/maps/search/?api=1&query=Kiyomizu+Junsei+Okabeya' },
                    { name: 'Hello Kitty Ëå∂ÂØÆ', desc: 'Â¶ÇÊûú‰∏çÁà±Ë±ÜËÖêÔºåÂèØ‰ª•ÂêÉËøô‰∏™', link: 'https://www.google.com/maps/search/?api=1&query=Hello+Kitty+Saryo+Ninenzaka' }
                ]
            },
            { id: 26, time: '14:30', location: '‰∏âÂπ¥ÂùÇ / ‰∫åÂπ¥ÂùÇ', action: 'ÈÄõË°óÂØªÂÆù', transport: 'Ê≠•Ë°å', 
              note: 'ËøôÈáåÊúâÂêâÂçúÂäõ‰∏ìÂçñÂ∫ó (Ê©°Â≠êÂÖ±ÂíåÂõΩ)„ÄÅËßíËêΩÁîüÁâ©Â∫óÔºåÂ∞èÂ≠©‰ºöÈÄõÁñØ„ÄÇ', 
              link: 'https://www.google.com/maps/search/?api=1&query=Donguri+Kyowakoku+Ninenzaka',
              coords: [35.0035, 135.7780],
              shopping: { name: 'Ê©°Â≠êÂÖ±ÂíåÂõΩ (ÂêâÂçúÂäõ)', desc: 'ÈæôÁå´Âë®Ëæπ', link: 'https://www.google.com/maps/search/?api=1&query=Donguri+Kyowakoku+Ninenzaka' } 
            },
            { id: 27, time: '18:00', location: 'Ê≤≥ÂéüÁî∫', action: 'ÊôöÈ§ê & Ë°•Ë¥ß', transport: 'Ê≠•Ë°å', 
              note: 'Â¶ÇÊûúÊò®Â§©‰ªªÂ§©Â†ÇÊ≤°‰π∞Â§üÔºå‰ªäÂ§©ÁªßÁª≠„ÄÇ',
              coords: [35.0040, 135.7730],
                foodOptions: [
                    { name: 'ÂØø„Åó„ÅÆ„ÇÄ„Åï„Åó (Musashi Sushi)', desc: 'Ëø¥ËΩ¨ÂØøÂè∏ÔºåÂèØ‰ª•ÈÄâËá™Â∑±Áà±ÁöÑ', link: 'https://www.google.com/maps/search/?api=1&query=Sushi+no+Musashi+Sanjo+Honten' },
                    { name: 'ÁÉßËÇâÂºò (Yakiniku Hiro)', desc: 'ÈúÄÈ¢ÑÁ∫¶Ôºå‰∫¨ÈÉΩ‰∏çÈîôÁöÑÁÉßËÇâ', link: 'https://www.google.com/maps/search/?api=1&query=Yakiniku+Hiro+Kiyamachi' }
                ]
            }
        ],
        4: [
            { id: 29, time: '08:05', location: 'È•≠Â∫ó ‚Üí ‰∫¨ÈÉΩÁ´ô (Kyoto St.)', action: 'ÂâçÂæÄËΩ¶Á´ô', transport: 'Uber', recommend: true, 
              transport_detail: 'ËØ∑ËÆæÂÆöÁõÆÁöÑÂú∞‰∏∫‰∫¨ÈÉΩÁ´ô„ÄåÂÖ´Êù°Âè£„Äç„ÄÇ',
              link: 'https://www.google.com/maps/search/?api=1&query=Kyoto+Station+Hachijo+Exit',
              coords: [34.9850, 135.7580] },
            { id: 30, time: '08:45', location: '‰∫¨ÈÉΩÁ´ô ‚Üí Êú∫Âú∫', action: 'Haruka ÁâπÊÄ• (Hello Kitty)', transport: '08:45 ÂèëËΩ¶', 
              transport_detail: 'Haruka ÁªèÂ∏∏Êúâ Hello Kitty ÂΩ©ÁªòÊ∂ÇË£ÖÔºåÊãçÁÖßÁïôÂøµ„ÄÇ',
              link: 'https://www.google.com/maps/search/?api=1&query=Kyoto+Station+Platform+30',
              coords: [34.9850, 135.7580] },
            { id: 31, time: '10:05', location: 'ÂÖ≥Ë•øÊú∫Âú∫ T1 (Kansai Airport)', action: 'ÊúÄÂêéÈááË¥≠', transport: 'Êé•È©≥ËΩ¶', 
              note: 'Êú∫Âú∫‰πüÊúâ Pokemon Store (T1 2F)„ÄÇ',
              link: 'https://www.google.com/maps/search/?api=1&query=Pokemon+Store+Kansai+Airport', 
              coords: [34.4357, 135.2443],
                shopping: { name: 'Pokemon Store', desc: 'ÂÖ≥Ë•øÊú∫Âú∫Â∫ó (T1 2F)', link: 'https://www.google.com/maps/search/?api=1&query=Pokemon+Store+Kansai+Airport' }
            }
        ]
    };

    const app = createApp({
        data() {
            return {
                currentDay: 0,
                currentView: 'list',
                showModal: false,
                isEditing: false,
                mapInstance: null,
                markerGroup: null,
                days: [
                    { date: '12/12 (‰∫î)', name: 'Day 1: ÊäµËææÂ§ßÈò™', desc: 'ÈÅìÈ°øÂ†Ä & Â§πÂ®ÉÂ®É', center: [34.6655, 135.5015], weather: { status: 'Êô¥Êó∂Â§ö‰∫ë', icon: 'fas fa-sun', temp_high: 11, temp_low: 5, color: 'text-orange-500', rain: false } },
                    { date: '12/13 (ÂÖ≠)', name: 'Day 2: Á•ûÊà∑/Êâ≠Ëõã', desc: 'ÁâõÊéí & Mosaic', center: [34.6901, 135.1955], weather: { status: 'Â§ö‰∫ëÊó∂Èò¥', icon: 'fas fa-cloud', temp_high: 11, temp_low: 4, color: 'text-gray-500', rain: false } },
                    { date: '12/14 (Êó•)', name: 'Day 3: ‰∫¨ÈÉΩ/‰ªªÂ§©Â†Ç', desc: 'Nintendo Kyoto', center: [35.0037, 135.7592], weather: { status: 'Èò¥Áü≠ÊöÇÈõ®', icon: 'fas fa-cloud-rain', temp_high: 14, temp_low: 7, color: 'text-blue-500', rain: true } },
                    { date: '12/15 (‰∏Ä)', name: 'Day 4: Ê∏ÖÊ∞¥ÂØ∫/ÂØªÂÆù', desc: '‰∏âÂπ¥ÂùÇÈÄõË°ó', center: [34.9949, 135.7850], weather: { status: 'Â§ö‰∫ë', icon: 'fas fa-cloud', temp_high: 11, temp_low: 6, color: 'text-gray-500', rain: false } },
                    { date: '12/16 (‰∫å)', name: 'Day 5: ËøîÁ®ã', desc: 'Haruka 08:45', center: [34.4320, 135.2304], weather: { status: 'Êô¥Êúó', icon: 'fas fa-sun', temp_high: 12, temp_low: 4, color: 'text-orange-500', rain: false } }
                ],
                activities: {},
                form: { id: null, time: '', location: '', action: '', transport: '', note: '', transport_detail: '', link: '', isHotel: false, isGame: false, recommend: false }
            }
        },
        computed: {
            currentActivities() { return this.activities[this.currentDay] || []; },
            sortedActivities() { return [...this.currentActivities].sort((a, b) => a.time.localeCompare(b.time)); }
        },
        mounted() { this.loadAndMergeData(); },
        methods: {
            loadAndMergeData() {
                try {
                    const saved = localStorage.getItem('japanTrip_v27_Kids912');
                    if (saved) { this.activities = JSON.parse(saved); } 
                    else { this.activities = JSON.parse(JSON.stringify(detailedData)); this.saveToStorage(); }
                } catch(e) { this.activities = JSON.parse(JSON.stringify(detailedData)); }
            },
            changeDay(index) {
                this.currentDay = index;
                this.currentView = 'list';
                if (this.mapInstance) this.$nextTick(() => { this.updateMapMarkers(); });
            },
            switchMap() {
                this.currentView = 'map';
                this.$nextTick(() => {
                    if (!this.mapInstance) this.initMap();
                    else { this.mapInstance.invalidateSize(); this.updateMapMarkers(); }
                });
            },
            initMap() {
                this.mapInstance = L.map('map');
                L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { attribution: '¬© OpenStreetMap', maxZoom: 19 }).addTo(this.mapInstance);
                this.markerGroup = L.layerGroup().addTo(this.mapInstance);
                this.updateMapMarkers();
            },
            updateMapMarkers() {
                if (!this.mapInstance || !this.markerGroup) return;
                this.markerGroup.clearLayers();
                const acts = this.currentActivities;
                const bounds = [];
                acts.forEach(item => {
                    if (item.coords) {
                        let color = 'blue';
                        if (item.isHotel) color = 'purple';
                        else if (item.foodOptions) color = 'orange';
                        else if (item.isGame) color = 'red'; // New color for Game/Shopping

                        const marker = L.circleMarker(item.coords, {
                            color: color === 'purple' ? '#8b5cf6' : (color === 'orange' ? '#f97316' : (color === 'red' ? '#ef4444' : '#3b82f6')),
                            fillColor: color === 'purple' ? '#8b5cf6' : (color === 'orange' ? '#f97316' : (color === 'red' ? '#ef4444' : '#3b82f6')),
                            fillOpacity: 0.8,
                            radius: 8
                        }).addTo(this.markerGroup);
                        marker.bindPopup(`<b>${item.location}</b><br>${item.action}`);
                        bounds.push(item.coords);
                    }
                });
                if (bounds.length > 0) this.mapInstance.fitBounds(bounds, { padding: [50, 50] });
                else this.mapInstance.setView(this.days[this.currentDay].center, 13);
            },
            openSmartMap(item) { if (item.link) window.open(item.link, '_blank'); },
            getIconColor(item) {
                if (item.isHotel) return 'bg-purple-500';
                if (item.isGame) return 'bg-red-500 ring-2 ring-red-200';
                if (item.recommend) return 'bg-black border-black'; 
                if (item.transport) return 'bg-blue-600'; 
                return 'bg-stone-300';
            },
            isKeyTime(time) { return (time === '17:35' || time === '08:45'); },
            openModal(item = null) {
                this.isEditing = !!item;
                this.form = item ? { ...item } : { id: Date.now(), time: '09:00', location: '', action: '', transport: '', note: '', transport_detail: '', link: '', isHotel: false, isGame: false, recommend: false };
                this.showModal = true;
            },
            saveActivity() {
                if (!this.form.location) return alert('ËØ∑ËæìÂÖ•Âú∞ÁÇπ');
                if (!this.activities[this.currentDay]) this.activities[this.currentDay] = [];
                if (this.isEditing) {
                    const idx = this.activities[this.currentDay].findIndex(x => x.id === this.form.id);
                    if (idx !== -1) this.activities[this.currentDay][idx] = { ...this.form };
                } else { this.activities[this.currentDay].push({ ...this.form }); }
                this.saveToStorage();
                this.showModal = false;
            },
            deleteActivity() {
                if(confirm('Âà†Èô§Ê≠§Ë°åÁ®ãÔºü')) {
                    this.activities[this.currentDay] = this.activities[this.currentDay].filter(x => x.id !== this.form.id);
                    this.saveToStorage();
                    this.showModal = false;
                }
            },
            saveToStorage() { localStorage.setItem('japanTrip_v27_Kids912', JSON.stringify(this.activities)); },
            resetData() {
                if(confirm('ÈáçÁΩÆ‰∏∫ 9 & 12 Â≤ÅÂ∞ëÂπ¥ÁâàÔºü')) {
                    this.activities = JSON.parse(JSON.stringify(detailedData));
                    this.saveToStorage();
                    this.currentDay = 0;
                    alert('Â∑≤Êõ¥Êñ∞ÔºÅ');
                }
            }
        }
    });
    app.mount('#app');
</script>
</body>
</html>
