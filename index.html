<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº¬é˜ªç¥ 5 æ—¥æ·±åº¦éŠ</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body {
            background-color: #f3f4f6;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .app-container {
            max-width: 480px;
            margin: 0 auto;
            background: #ffffff;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
        }
        #map {
            height: 100%;
            width: 100%;
            z-index: 0;
        }
        .slide-fade-enter-active {
            transition: all 0.3s ease-out;
        }
        .slide-fade-leave-active {
            transition: all 0.2s cubic-bezier(1.0, 0.5, 0.8, 1.0);
        }
        .slide-fade-enter-from,
        .slide-fade-leave-to {
            transform: translateY(20px);
            opacity: 0;
        }
        /* é‡å°ä¸åŒé¡å‹çš„æ¨™ç±¤é¡è‰² */
        .tag-transport { background-color: #e0f2fe; color: #0369a1; }
        .tag-food { background-color: #fce7f3; color: #be185d; }
        .tag-shopping { background-color: #fff7ed; color: #c2410c; }
    </style>
</head>
<body>

<div id="app" class="app-container flex flex-col">
    
    <header class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6 rounded-b-3xl shadow-lg z-20 relative">
        <div class="flex justify-between items-center mb-4">
            <div>
                <h1 class="text-2xl font-bold tracking-tight">äº¬é˜ªç¥æ·±åº¦éŠ ğŸ‡¯ğŸ‡µ</h1>
                <p class="text-blue-100 text-xs opacity-90">å¤§é˜ª â€¢ ç¥æˆ¶ â€¢ äº¬éƒ½ â€¢ è³¼ç‰©</p>
            </div>
            <button @click="resetData" class="text-xs bg-white/20 px-3 py-1 rounded-full hover:bg-white/30 transition">
                é‡ç½®è¡Œç¨‹
            </button>
        </div>

        <div class="flex space-x-3 overflow-x-auto no-scrollbar pb-2">
            <button 
                v-for="(day, index) in days" 
                :key="index"
                @click="changeDay(index)"
                :class="currentDay === index ? 'bg-white text-blue-600 font-bold shadow-md' : 'bg-blue-800/40 text-blue-100'"
                class="px-4 py-2 rounded-xl text-sm whitespace-nowrap transition-all duration-300 flex-shrink-0 border border-transparent">
                {{ day.shortName }}
            </button>
        </div>
    </header>

    <main class="flex-1 relative overflow-hidden bg-gray-50">
        
        <div v-if="currentView === 'list'" class="h-full overflow-y-auto pb-24 px-4 pt-6 no-scrollbar">
            
            <div class="mb-4 ml-2">
                <h2 class="text-xl font-bold text-gray-800">{{ days[currentDay].name }}</h2>
                <p class="text-sm text-gray-500">{{ days[currentDay].desc }}</p>
            </div>

            <div v-if="currentActivities.length === 0" class="text-center text-gray-400 mt-20">
                <i class="fas fa-suitcase-rolling text-4xl mb-3"></i>
                <p>ç„¡è¡Œç¨‹è³‡æ–™</p>
            </div>

            <transition-group name="slide-fade" tag="div" class="space-y-4">
                <div v-for="(item, idx) in sortedActivities" :key="item.id" class="relative pl-6 border-l-2 border-indigo-200">
                    <div class="absolute -left-[9px] top-4 w-4 h-4 bg-indigo-500 rounded-full border-4 border-white shadow-sm"></div>
                    
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 active:scale-[0.98] transition-transform duration-200">
                        <div class="flex justify-between items-start">
                            <div class="flex-1 mr-2">
                                <span class="inline-block bg-indigo-50 text-indigo-600 text-xs font-bold px-2 py-1 rounded-md mb-2">
                                    {{ item.time }}
                                </span>
                                <h3 class="font-bold text-gray-800 text-lg">{{ item.location }}</h3>
                                <p class="text-gray-600 text-sm mt-1 font-medium">{{ item.action }}</p>
                                
                                <div class="mt-3 space-y-1">
                                    <div v-if="item.transport" class="flex items-start text-xs text-blue-600 bg-blue-50 p-2 rounded-lg">
                                        <i class="fas fa-train mt-0.5 mr-1.5 flex-shrink-0"></i>
                                        <span>{{ item.transport }}</span>
                                    </div>
                                    <div v-if="item.note" class="flex items-start text-xs text-gray-500 bg-gray-50 p-2 rounded-lg">
                                        <i class="fas fa-info-circle mt-0.5 mr-1.5 flex-shrink-0"></i>
                                        <span>{{ item.note }}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex flex-col space-y-2 flex-shrink-0">
                                <button @click="openGoogleMaps(item.location)" class="w-8 h-8 rounded-full bg-green-50 text-green-600 flex items-center justify-center hover:bg-green-100 shadow-sm">
                                    <i class="fas fa-location-arrow text-sm"></i>
                                </button>
                                <button @click="editActivity(item)" class="w-8 h-8 rounded-full bg-gray-50 text-gray-400 flex items-center justify-center hover:bg-gray-100">
                                    <i class="fas fa-pen text-xs"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </transition-group>
            
            <div class="h-20"></div>
        </div>

        <div v-show="currentView === 'map'" class="h-full w-full relative">
            <div id="map" class="w-full h-full"></div>
            <div class="absolute bottom-24 left-4 right-4 bg-white/90 backdrop-blur p-3 rounded-xl shadow-lg z-[500] text-xs">
                <p><span class="font-bold text-indigo-600">ç›®å‰æª¢è¦–ï¼š</span> {{ days[currentDay].name }}</p>
                <p class="text-gray-500 mt-1">åœ°åœ–å·²å®šä½è‡³ç•¶æ—¥é‡é»å€åŸŸ</p>
            </div>
        </div>

    </main>

    <nav class="absolute bottom-0 w-full bg-white border-t border-gray-200 px-6 py-3 flex justify-between items-center z-30 pb-safe">
        <button @click="currentView = 'list'" :class="currentView === 'list' ? 'text-indigo-600' : 'text-gray-400'" class="flex flex-col items-center space-y-1 w-16">
            <i class="fas fa-list-ul text-xl"></i>
            <span class="text-[10px] font-medium">è¡Œç¨‹</span>
        </button>
        
        <button @click="openModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg shadow-indigo-300 transform -translate-y-6 transition hover:scale-105 active:scale-95">
            <i class="fas fa-plus text-xl"></i>
        </button>

        <button @click="switchMap" :class="currentView === 'map' ? 'text-indigo-600' : 'text-gray-400'" class="flex flex-col items-center space-y-1 w-16">
            <i class="fas fa-map-marked-alt text-xl"></i>
            <span class="text-[10px] font-medium">åœ°åœ–</span>
        </button>
    </nav>

    <div v-if="showModal" class="absolute inset-0 z-50 flex items-end sm:items-center justify-center bg-black/50 backdrop-blur-sm p-4 transition-opacity">
        <div class="bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl animate-bounce-up max-h-[90vh] overflow-y-auto">
            <h2 class="text-xl font-bold text-gray-800 mb-4">
                {{ isEditing ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹' }}
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">æ™‚é–“</label>
                    <input type="time" v-model="form.time" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">åœ°é» (æ—¥æ–‡æ¼¢å­—)</label>
                    <input type="text" v-model="form.location" placeholder="ä¾‹å¦‚: æ¸…æ°´å¯º" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">è¡Œç¨‹å…§å®¹</label>
                    <input type="text" v-model="form.action" placeholder="ä¾‹å¦‚: ç©¿å’Œæœæ‹ç…§" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">äº¤é€šæ–¹å¼</label>
                    <input type="text" v-model="form.transport" placeholder="ä¾‹å¦‚: JRå¥ˆè‰¯ç·š (å¯ç•™ç©º)" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">å‚™è¨»</label>
                    <textarea v-model="form.note" placeholder="å‚™è¨»äº‹é …" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 h-20 resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                </div>
            </div>

            <div class="flex gap-3 mt-6">
                <button v-if="isEditing" @click="deleteActivity" class="flex-1 bg-red-50 text-red-500 font-bold py-3 rounded-xl hover:bg-red-100">
                    åˆªé™¤
                </button>
                <button v-if="!isEditing" @click="showModal = false" class="flex-1 bg-gray-100 text-gray-500 font-bold py-3 rounded-xl hover:bg-gray-200">
                    å–æ¶ˆ
                </button>
                <button @click="saveActivity" class="flex-[2] bg-indigo-600 text-white font-bold py-3 rounded-xl shadow-lg shadow-indigo-200 hover:bg-indigo-700">
                    {{ isEditing ? 'æ›´æ–°' : 'æ–°å¢' }}
                </button>
            </div>
             <button v-if="isEditing" @click="showModal = false" class="mt-3 w-full text-gray-400 text-sm py-2">å–æ¶ˆç·¨è¼¯</button>
        </div>
    </div>

</div>

<script>
    const { createApp } = Vue;

    // é è¨­è³‡æ–™
    const defaultData = {
        0: [
            { id: 1, time: '16:00', location: 'é–¢è¥¿å›½éš›ç©ºæ¸¯ (KIX)', action: 'æŠµé”æ©Ÿå ´', transport: '', note: 'å…¥å¢ƒå¯©æŸ¥ã€é ˜å–è¡Œæ' },
            { id: 2, time: '17:00', location: 'å—æµ·ãªã‚“ã°é§…', action: 'æ­è»Šå‰å¾€é›£æ³¢', transport: 'å—æµ·é›»éµã€Œç‰¹æ€¥ãƒ©ãƒ”ãƒ¼ãƒˆã€ (ç´„34-38åˆ†)', note: 'èˆ’é©å¿«é€Ÿï¼Œç›´é”å¸‚å€' },
            { id: 3, time: '18:00', location: 'ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³Â·ãƒã‚¤Â·ãƒã‚¤ã‚¢ãƒƒãƒˆé›£æ³¢å¤§é˜ª', action: 'é£¯åº— Check-in', transport: 'æ­¥è¡Œ', note: 'ä½æ–¼æ—¥æœ¬æ©‹ç«™æ—' },
            { id: 4, time: '19:00', location: 'é“é “å €Â·å¿ƒæ–æ©‹', action: 'æ™šé¤ï¼‹æ•£æ­¥', transport: 'æ­¥è¡Œ', note: 'å¿…æ‹ Glico è·‘è·‘äººæ‹›ç‰Œ' },
            { id: 5, time: '20:00', location: 'ãƒ‰ãƒ³Â·ã‚­ãƒ›ãƒ¼ãƒ† é“é “å €åº—', action: 'Donki / è—¥å¦å°è²·', transport: 'æ­¥è¡Œ', note: '24HRç‡Ÿæ¥­ï¼Œè²·æ—…é€”ä¸­æ€¥éœ€å“' },
            { id: 6, time: '21:00', location: 'æ—¥æœ¬æ©‹Â·é»’é–€å¸‚å ´å‘¨é‚Š', action: 'å›é£¯åº—ä¼‘æ¯', transport: 'æ­¥è¡Œ', note: 'é¤Šç²¾è“„éŠ³' }
        ],
        1: [
            { id: 7, time: '09:00', location: 'ç¥æˆ¸ä¸‰å®®é§…', action: 'å‡ºç™¼å»ç¥æˆ¶', transport: 'é˜ªç¥ãªã‚“ã°ç·š ç›´é€š (ç´„45åˆ†)', note: 'å¤§é˜ªé›£æ³¢å‡ºç™¼' },
            { id: 8, time: '10:00', location: 'ç”Ÿç”°ç¥ç¤¾ / ä¸‰å®®ã‚»ãƒ³ã‚¿ãƒ¼è¡—', action: 'ä¸‰å®®å‘¨é‚Šæ•£æ­¥', transport: 'æ­¥è¡Œ', note: 'ç¥ˆæ±‚æˆ€æ„›é‹ã€é€›è¡—' },
            { id: 9, time: '12:00', location: 'ãƒ¢ãƒ¼ãƒªãƒ¤ / æ¡œ', action: 'ç¥æˆ¶ç‰›åˆé¤', transport: 'æ­¥è¡Œ', note: 'â˜… å¼·çƒˆå»ºè­°äº‹å…ˆé ç´„' },
            { id: 10, time: '14:00', location: 'ç¥æˆ¸ãƒãƒ¼ãƒãƒ¼ãƒ©ãƒ³ãƒ‰', action: 'æ¸¯å£æ‹ç…§', transport: 'åœ°ä¸‹éµæµ·å²¸ç·š / æ­¥è¡Œ', note: 'ç¥æˆ¶æ¸¯å¡”ã€ç¾åˆ©å …å…¬åœ’' },
            { id: 11, time: '17:00', location: 'å¤§é˜ªé›£æ³¢é§…', action: 'å›å¤§é˜ª', transport: 'é˜ªç¥ãªã‚“ã°ç·š', note: 'è¿”å›å¸‚å€' },
            { id: 12, time: '18:00', location: 'é“é “å € / ãªã‚“ã°CITY', action: 'æ™šé¤', transport: 'æ­¥è¡Œ', note: '' },
            { id: 13, time: '19:00', location: 'ãªã‚“ã°ãƒ­ãƒ•ãƒˆ (Loft)', action: 'æ–‡å…·è³¼ç‰©ç¬¬ä¸€æˆ°', transport: 'æ­¥è¡Œ', note: 'Loft æˆ– Hands Be' },
            { id: 14, time: '21:00', location: 'æ—¥æœ¬æ©‹é£¯åº—', action: 'å›é£¯åº—ä¼‘æ¯', transport: '', note: '' }
        ],
        2: [
            { id: 15, time: '08:30', location: 'é»’é–€å¸‚å ´', action: 'åƒæµ·é®®/å’Œç‰›æ—©é¤', transport: 'æ­¥è¡Œ', note: 'æ°´æœã€æµ·é®®ã€å°åƒ' },
            { id: 16, time: '10:00', location: 'ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³Â·ãƒã‚¤Â·ãƒã‚¤ã‚¢ãƒƒãƒˆé›£æ³¢å¤§é˜ª', action: 'é€€æˆ¿ & å¯„æ”¾è¡Œæ', transport: '', note: 'è¼•è£å»åƒåˆé¤' },
            { id: 17, time: '12:30', location: 'é›£æ³¢å‘¨é‚Š', action: 'é ˜å–è¡Œæ / åˆé¤', transport: '', note: '' },
            { id: 18, time: '14:00', location: 'äº¬éƒ½é§…', action: 'ç§»å‹•å‰å¾€äº¬éƒ½', transport: 'å¾¡å ‚ç­‹ç·š(æ¢…ç”°)è½‰JRæ–°å¿«é€Ÿ (ç´„60åˆ†)', note: 'é›£æ³¢->æ¢…ç”°->äº¬éƒ½' },
            { id: 19, time: '15:30', location: 'ãƒã‚¤ã‚¢ãƒƒãƒˆ ãƒ—ãƒ¬ã‚¤ã‚¹ äº¬éƒ½', action: 'æŠµé”é£¯åº— Check-in', transport: 'åœ°ä¸‹éµçƒä¸¸ç·š (ä¸¸å¤ªç”ºç«™6è™Ÿå£)', note: 'ç«™å£ç›´çµï¼Œéå¸¸æ–¹ä¾¿' },
            { id: 20, time: '17:00', location: 'äº¬éƒ½å¾¡è‹‘ / äº¬éƒ½å¾¡æ‰€', action: 'å‚æ™šæ•£æ­¥', transport: 'æ­¥è¡Œ', note: 'å°±åœ¨é£¯åº—æ—ï¼Œæ”¾é¬†å¥½å»è™•' },
            { id: 21, time: '19:00', location: 'å››æ¡ / çƒä¸¸', action: 'äº¬éƒ½æ™šé¤', transport: 'åœ°éµ / æ­¥è¡Œ', note: 'å°‹æ‰¾äº¬éƒ½ç¾é£Ÿ' }
        ],
        3: [
            { id: 22, time: '08:30', location: 'ä¼è¦‹ç¨²è·å¤§ç¤¾', action: 'åƒæœ¬é³¥å±…', transport: 'çƒä¸¸ç·š->äº¬éƒ½->JRå¥ˆè‰¯ç·š(ç¨²è·ç«™)', note: 'æ—©é»å»é¿é–‹äººæ½®' },
            { id: 23, time: '11:30', location: 'äº”æ¡å‚ / æ¸…æ°´é“', action: 'å‰å¾€æ¸…æ°´å¯ºå€åŸŸ', transport: 'JRå›äº¬éƒ½è½‰å·´å£« (100/206)', note: '' },
            { id: 24, time: '12:00', location: 'äºŒå¹´å‚ / ä¸‰å¹´å‚', action: 'åˆé¤', transport: 'æ­¥è¡Œ', note: 'å’Œé£Ÿã€æŠ¹èŒ¶ç”œé»' },
            { id: 25, time: '13:00', location: 'æ¸…æ°´å¯º', action: 'æ¸…æ°´èˆå°', transport: 'æ­¥è¡Œ', note: 'å¿…è¨ªæ™¯é»' },
            { id: 26, time: '14:30', location: 'äºŒå¯§å‚ / ç”£å¯§å‚', action: 'å¤è¡—é€›è¡—', transport: 'æ­¥è¡Œ', note: 'å¾ˆå¤šç‰¹è‰²å°åº—' },
            { id: 27, time: '16:00', location: 'ç¥‡åœ’ / èŠ±è¦‹å°è·¯', action: 'æ„Ÿå—äº¬éƒ½æ°›åœ', transport: 'æ­¥è¡Œ', note: 'å‚æ™šæ™‚åˆ†æœ€ç¾' },
            { id: 28, time: '17:00', location: 'äº¬éƒ½ãƒ­ãƒ•ãƒˆ / ä¸¸å–„', action: 'æ–‡å…·é‡é»å€', transport: 'æ­¥è¡Œ(æ²³åŸç”ºÂ·ä¸‰æ¡)', note: 'æ–‡å…·ç¬¬äºŒè¼ªå¤§æ¡è³¼' },
            { id: 29, time: '18:30', location: 'å››æ¡æ²³åŸç”º', action: 'æ™šé¤', transport: 'æ­¥è¡Œ', note: '' },
            { id: 30, time: '19:30', location: 'å››æ¡é€šè—¥å¦åº—', action: 'è—¥å¦å¤§æ¡è³¼', transport: 'æ­¥è¡Œ', note: 'æ¾æœ¬æ¸…/Sugi/é¶´ç¾½ï¼Œåƒ¹æ ¼ç«¶çˆ­æ¿€çƒˆ' },
            { id: 31, time: '20:30', location: 'ãƒ‰ãƒ³Â·ã‚­ãƒ›ãƒ¼ãƒ† å››æ¡æ²³åŸç”º', action: 'Donki æœ€çµ‚æˆ°', transport: 'æ­¥è¡Œ', note: 'è²·åˆ°è¡Œæç®±å¡æ»¿ç‚ºæ­¢' },
            { id: 32, time: '22:00', location: 'ãƒã‚¤ã‚¢ãƒƒãƒˆ ãƒ—ãƒ¬ã‚¤ã‚¹ äº¬éƒ½', action: 'å›é£¯åº—æ‰“åŒ…', transport: 'åœ°éµ (äº¬éƒ½å¸‚å½¹æ‰€å‰->ä¸¸å¤ªç”º)', note: 'æœ€å¾Œæ•´ç†è¡Œæ' }
        ],
        4: [
            { id: 33, time: '08:00', location: 'ãƒã‚¤ã‚¢ãƒƒãƒˆ ãƒ—ãƒ¬ã‚¤ã‚¹ äº¬éƒ½', action: 'é£¯åº—å‡ºç™¼', transport: 'æ­¥è¡Œ -> çƒä¸¸ç·š -> äº¬éƒ½é§…', note: 'å»ºè­°ææ—©å‡ºç™¼' },
            { id: 34, time: '08:15', location: 'äº¬éƒ½é§…', action: 'æ­ä¹˜ HARUKA', transport: 'JRç‰¹æ€¥ ã¯ã‚‹ã‹ (ç´„75åˆ†)', note: 'å‰å¾€é—œè¥¿æ©Ÿå ´' },
            { id: 35, time: '10:00', location: 'é–¢è¥¿å›½éš›ç©ºæ¸¯', action: 'æŠµé”æ©Ÿå ´', transport: '', note: 'è¾¦ç†ç™»æ©Ÿã€æ‰˜é‹' },
            { id: 36, time: '12:00', location: 'é–¢è¥¿å›½éš›ç©ºæ¸¯', action: 'é£›æ©Ÿèµ·é£›', transport: '', note: 'æ°æ°æ—¥æœ¬ï¼' }
        ]
    };

    createApp({
        data() {
            return {
                currentDay: 0, 
                currentView: 'list', 
                showModal: false,
                isEditing: false,
                mapInstance: null,
                days: [
                    { shortName: 'Day 1 (äº”)', name: 'Day 1: æŠµé”å¤§é˜ª', desc: 'æ©Ÿå ´ â†’ é›£æ³¢ â†’ é“é “å €', center: [34.6687, 135.5013] },
                    { shortName: 'Day 2 (å…­)', name: 'Day 2: ç¥æˆ¶ä¸€æ—¥', desc: 'ç¥æˆ¶ç‰› â†’ æ¸¯å£ â†’ æ–‡å…·', center: [34.6901, 135.1955] },
                    { shortName: 'Day 3 (æ—¥)', name: 'Day 3: ç§»å‹•æ—¥', desc: 'é»‘é–€å¸‚å ´ â†’ äº¬éƒ½å…¥ä½', center: [35.0163, 135.7592] },
                    { shortName: 'Day 4 (ä¸€)', name: 'Day 4: äº¬éƒ½å·¡ç¦®', desc: 'ä¼è¦‹ç¨»è· â†’ æ¸…æ°´å¯º â†’ è³¼ç‰©', center: [35.0037, 135.7786] },
                    { shortName: 'Day 5 (äºŒ)', name: 'Day 5: è¿”ç¨‹', desc: 'äº¬éƒ½ â†’ æ©Ÿå ´', center: [34.4320, 135.2304] }
                ],
                activities: {},
                form: {
                    id: null,
                    time: '',
                    location: '',
                    action: '',
                    transport: '',
                    note: ''
                }
            }
        },
        computed: {
            currentActivities() {
                return this.activities[this.currentDay] || [];
            },
            sortedActivities() {
                return [...this.currentActivities].sort((a, b) => a.time.localeCompare(b.time));
            }
        },
        mounted() {
            this.loadFromStorage();
        },
        methods: {
            changeDay(index) {
                this.currentDay = index;
                this.currentView = 'list';
            },
            switchMap() {
                this.currentView = 'map';
                this.$nextTick(() => {
                    if (!this.mapInstance) {
                        this.initMap();
                    } else {
                        const center = this.days[this.currentDay].center;
                        this.mapInstance.setView(center, 13);
                        this.mapInstance.invalidateSize(); 
                    }
                });
            },
            initMap() {
                const center = this.days[this.currentDay].center;
                this.mapInstance = L.map('map').setView(center, 13);
                
                L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                    attribution: 'Â© OpenStreetMap contributors',
                    maxZoom: 19
                }).addTo(this.mapInstance);
            },
            openGoogleMaps(location) {
                const query = encodeURIComponent(location);
                window.open(`https://www.google.com/maps/search/?api=1&query=${query}`, '_blank');
            },
            openModal(item = null) {
                if (item) {
                    this.isEditing = true;
                    this.form = { ...item };
                } else {
                    this.isEditing = false;
                    this.form = { id: Date.now(), time: '09:00', location: '', action: '', transport: '', note: '' };
                }
                this.showModal = true;
            },
            saveActivity() {
                if (!this.form.location) return alert('è«‹è¼¸å…¥åœ°é»');
                
                if (!this.activities[this.currentDay]) {
                    this.activities[this.currentDay] = [];
                }

                if (this.isEditing) {
                    const index = this.activities[this.currentDay].findIndex(x => x.id === this.form.id);
                    if (index !== -1) {
                        this.activities[this.currentDay][index] = { ...this.form };
                    }
                } else {
                    this.activities[this.currentDay].push({ ...this.form });
                }

                this.saveToStorage();
                this.showModal = false;
            },
            deleteActivity() {
                if(confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹è¡Œç¨‹å—ï¼Ÿ')) {
                    this.activities[this.currentDay] = this.activities[this.currentDay].filter(x => x.id !== this.form.id);
                    this.saveToStorage();
                    this.showModal = false;
                }
            },
            editActivity(item) {
                this.openModal(item);
            },
            saveToStorage() {
                // ä½¿ç”¨ v2 é¿å…èˆ‡èˆŠè³‡æ–™è¡çª
                localStorage.setItem('japanTripData_v2', JSON.stringify(this.activities));
            },
            loadFromStorage() {
                const data = localStorage.getItem('japanTripData_v2');
                if (data) {
                    this.activities = JSON.parse(data);
                } else {
                    // å¦‚æœæ²’æœ‰ V2 è³‡æ–™ï¼Œè¼‰å…¥é è¨­è³‡æ–™
                    this.activities = JSON.parse(JSON.stringify(defaultData));
                    this.saveToStorage();
                }
            },
            resetData() {
                if(confirm('ç¢ºå®šè¦é‡ç½®å›é è¨­è¡Œç¨‹å—ï¼Ÿæ‰€æœ‰è‡ªè¨‚è³‡æ–™å°‡æ¶ˆå¤±ã€‚')) {
                    this.activities = JSON.parse(JSON.stringify(defaultData));
                    this.saveToStorage();
                    this.currentDay = 0;
                    alert('è¡Œç¨‹å·²é‡ç½®');
                }
            }
        },
        watch: {
            currentDay(newVal) {
                if (this.currentView === 'map' && this.mapInstance) {
                    const center = this.days[newVal].center;
                    this.mapInstance.flyTo(center, 13);
                }
            }
        }
    }).mount('#app');
</script>

<style>
@keyframes bounce-up {
    0% { transform: translateY(20px); opacity: 0; }
    100% { transform: translateY(0); opacity: 1; }
}
.animate-bounce-up {
    animation: bounce-up 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}
.pb-safe {
    padding-bottom: env(safe-area-inset-bottom);
}
</style>

</body>
</html>
