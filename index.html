<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº¬é˜ªç¥è¦ªå­éŠ (v23 ç²¾ç¢ºæ™‚åˆ»ç‰ˆ)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>

    <style>
        body { background-color: #fff7ed; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        #map { height: 100%; width: 100%; z-index: 1; }
        [v-cloak] { display: none; }
        .map-btn { transition: all 0.2s; }
        .map-btn:active { transform: scale(0.95); }
        .vip-badge { background: linear-gradient(135deg, #1f2937 0%, #000000 100%); color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; margin-left: 5px; box-shadow: 0 2px 4px rgba(0,0,0, 0.2); }
        .hotel-badge { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); color: white; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; margin-left: 5px; }
        .transport-badge { background: #e0f2fe; color: #0369a1; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; border: 1px solid #bae6fd; }
        .food-card { background-color: #fffbeb; border: 1px solid #fed7aa; border-radius: 0.75rem; padding: 0.75rem; margin-top: 0.75rem; box-shadow: 0 2px 5px rgba(251, 146, 60, 0.05); }
        .shop-card { background-color: #fff1f2; border: 1px solid #fda4af; border-radius: 0.75rem; padding: 0.75rem; margin-top: 0.5rem; color: #9f1239; }
        .transport-detail { background-color: #f8fafc; border-left: 3px solid #64748b; padding: 0.75rem; margin-top: 0.5rem; border-radius: 0 0.5rem 0.5rem 0; }
        .time-highlight { color: #dc2626; font-weight: 800; }
    </style>
</head>
<body>

<div id="app" v-cloak class="max-w-md mx-auto bg-white min-h-screen relative shadow-2xl flex flex-col">
    
    <header class="bg-gradient-to-r from-orange-600 to-red-600 text-white p-5 pb-4 rounded-b-[2rem] shadow-xl z-20 sticky top-0">
        <div class="flex justify-between items-center mb-4">
            <div>
                <h1 class="text-xl font-bold tracking-wide">äº¬é˜ªç¥è¦ªå­éŠ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</h1>
                <p class="text-orange-100 text-xs mt-1 font-medium">v23: æ™‚åˆ»è¡¨ç¢ºèªç‰ˆ</p>
            </div>
            <button @click="resetData" class="text-xs bg-white/20 border border-white/30 px-3 py-1.5 rounded-full hover:bg-white/30 transition backdrop-blur-sm">é‡ç½®</button>
        </div>
        <div class="flex space-x-2 overflow-x-auto no-scrollbar pb-1">
            <button v-for="(day, index) in days" :key="index" @click="changeDay(index)"
                :class="currentDay === index ? 'bg-white text-orange-700 font-bold shadow-lg scale-105 ring-2 ring-white/50' : 'bg-orange-800/40 text-orange-100 hover:bg-orange-700/60'"
                class="px-3 py-2 rounded-xl text-xs whitespace-nowrap transition-all flex-shrink-0 mb-2 flex flex-col items-center min-w-[4.5rem]">
                <span>{{ day.date }}</span>
                <span class="text-[10px] opacity-80 mt-0.5">{{ day.weather.temp_high }}Â°</span>
            </button>
        </div>
    </header>

    <main class="flex-1 relative bg-stone-50 overflow-hidden">
        
        <div v-show="currentView === 'list'" class="h-full overflow-y-auto pb-24 px-4 pt-4 no-scrollbar">
            
            <div class="mb-5 bg-white rounded-2xl p-4 shadow-sm border border-stone-200 flex items-center justify-between">
                <div>
                    <h2 class="text-lg font-bold text-stone-800">{{ days[currentDay].name }}</h2>
                    <div class="flex items-center mt-1 text-sm font-medium" :class="days[currentDay].weather.color">
                        <i :class="days[currentDay].weather.icon" class="mr-2 text-lg"></i>
                        <span>{{ days[currentDay].weather.status }}</span>
                    </div>
                </div>
                <div v-if="days[currentDay].weather.rain" class="text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded-lg">
                    <i class="fas fa-umbrella mr-1"></i>å¸¶å‚˜
                </div>
            </div>

            <div class="space-y-5 pb-20">
                <div v-for="item in sortedActivities" :key="item.id" class="relative pl-6 border-l-[3px] border-stone-200 last:border-0">
                    <div class="absolute -left-[10px] top-5 w-5 h-5 rounded-full border-4 border-white shadow-sm transition-colors duration-300"
                         :class="getIconColor(item)"></div>
                    
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-stone-100 hover:shadow-md transition-all duration-300 group">
                        <div class="flex justify-between items-start">
                            <div class="flex-1 mr-3">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="bg-stone-100 text-stone-600 text-[11px] font-bold px-2 py-0.5 rounded" :class="{'text-red-600 bg-red-50': isKeyTime(item.time)}">{{ item.time }}</span>
                                    <span v-if="item.isHotel" class="hotel-badge"><i class="fas fa-bed mr-1"></i>é£¯åº—</span>
                                    <span v-if="item.recommend" class="vip-badge"><i class="fab fa-uber mr-1"></i>Uber</span>
                                    <span v-if="item.transport && !item.recommend" class="transport-badge"><i class="fas fa-train mr-1"></i>äº¤é€š</span>
                                </div>
                                <h3 class="font-bold text-stone-800 text-[15px] leading-tight">{{ item.location }}</h3>
                                <p class="text-stone-600 text-sm mt-1 font-medium">{{ item.action }}</p>
                                
                                <div v-if="item.transport_detail" class="transport-detail">
                                    <p class="text-xs text-slate-800 font-bold mb-1"><i class="fas fa-info-circle mr-1 text-slate-500"></i>æ­ä¹˜æŒ‡å¼•ï¼š</p>
                                    <p class="text-[11px] text-slate-600 leading-relaxed whitespace-pre-line">{{ item.transport_detail }}</p>
                                </div>

                                <div v-if="item.note && !item.transport_detail" class="mt-2 text-xs text-stone-500 bg-stone-50 p-2 rounded-lg">
                                    <i class="fas fa-info-circle mr-1 text-stone-400"></i>{{ item.note }}
                                </div>

                                <div v-if="item.foodOptions" class="food-card">
                                    <p class="text-xs font-bold text-orange-700 mb-2 border-b border-orange-100 pb-1">
                                        <i class="fas fa-utensils mr-1"></i>ç²¾é¸æ¨è–¦
                                    </p>
                                    <div class="space-y-2">
                                        <div v-for="(food, fIdx) in item.foodOptions" :key="fIdx" class="flex items-center justify-between">
                                            <div>
                                                <p class="text-xs font-bold text-gray-800">{{ food.name }}</p>
                                                <p class="text-[10px] text-gray-500">{{ food.desc }}</p>
                                            </div>
                                            <a :href="food.link" target="_blank" class="text-orange-500 hover:text-orange-700 ml-2 p-1 bg-orange-50 rounded-lg">
                                                <i class="fas fa-map-marker-alt"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>

                                <div v-if="item.shopping" class="shop-card flex items-center justify-between">
                                    <div>
                                        <p class="text-xs font-bold"><i class="fas fa-shopping-cart mr-1"></i>{{ item.shopping.name }}</p>
                                        <p class="text-[10px] opacity-80">{{ item.shopping.desc }}</p>
                                    </div>
                                    <a :href="item.shopping.link" target="_blank" class="bg-white text-pink-600 w-6 h-6 flex items-center justify-center rounded-full shadow-sm">
                                        <i class="fas fa-map-pin text-[10px]"></i>
                                    </a>
                                </div>
                            </div>
                            
                            <div class="flex flex-col space-y-3 pt-1">
                                <button v-if="item.link" @click="openSmartMap(item)" 
                                    class="map-btn w-10 h-10 rounded-xl bg-black text-white shadow-gray-400 shadow-md hover:bg-gray-800 flex items-center justify-center">
                                    <i class="fas fa-location-arrow text-sm"></i>
                                </button>
                                <button v-else class="w-10 h-10 rounded-xl bg-stone-100 text-stone-300 flex items-center justify-center cursor-default">
                                    <i class="fas fa-map-marker-alt text-sm"></i>
                                </button>
                                
                                <button @click="editActivity(item)" class="map-btn w-10 h-10 rounded-xl bg-stone-50 text-stone-400 flex items-center justify-center hover:bg-stone-100">
                                    <i class="fas fa-pen text-xs"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-show="currentView === 'map'" class="absolute inset-0 z-0">
            <div id="map"></div>
        </div>
    </main>

    <nav class="absolute bottom-0 w-full bg-white/95 backdrop-blur border-t border-stone-100 px-6 py-2 flex justify-between items-center z-30 pb-6 pt-3 shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
        <button @click="currentView = 'list'" :class="currentView === 'list' ? 'text-orange-600' : 'text-stone-400'" class="flex flex-col items-center w-16 transition-colors">
            <i class="fas fa-list-ul text-lg mb-1"></i><span class="text-[10px] font-medium">è¡Œç¨‹</span>
        </button>
        <button @click="openModal()" class="bg-orange-600 text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg shadow-orange-200 -translate-y-5 hover:scale-105 active:scale-95 transition-all">
            <i class="fas fa-plus text-xl"></i>
        </button>
        <button @click="switchMap" :class="currentView === 'map' ? 'text-orange-600' : 'text-stone-400'" class="flex flex-col items-center w-16 transition-colors">
            <i class="fas fa-map-marked-alt text-lg mb-1"></i><span class="text-[10px] font-medium">åœ°åœ–</span>
        </button>
    </nav>

    <div v-if="showModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-stone-900/60 p-4 backdrop-blur-sm transition-opacity">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-bounce-up">
            <h2 class="text-lg font-bold mb-4 text-stone-800">{{ isEditing ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹' }}</h2>
            <div class="space-y-3">
                <div class="flex gap-3">
                    <input type="time" v-model="form.time" class="w-1/3 bg-stone-50 border border-stone-200 rounded-xl p-3 outline-none focus:border-orange-500 transition">
                    <input type="text" v-model="form.location" placeholder="åœ°é»" class="w-2/3 bg-stone-50 border border-stone-200 rounded-xl p-3 outline-none focus:border-orange-500 transition">
                </div>
                <input type="text" v-model="form.action" placeholder="å…§å®¹" class="w-full bg-stone-50 border border-stone-200 rounded-xl p-3 outline-none focus:border-orange-500 transition">
                <input type="text" v-model="form.transport" placeholder="äº¤é€šç°¡è¿°" class="w-full bg-stone-50 border border-stone-200 text-stone-800 rounded-xl p-3 outline-none focus:border-orange-400 placeholder-stone-400 transition">
                <textarea v-model="form.transport_detail" placeholder="äº¤é€šè©³ç´°èªªæ˜ (æœˆå°/ç¥¨å‹™/æŒ‡å¼•)" class="w-full bg-stone-50 border border-stone-200 rounded-xl p-3 h-20 resize-none outline-none focus:border-orange-500 transition"></textarea>
                <input type="text" v-model="form.link" placeholder="Google Maps é€£çµ" class="w-full bg-stone-50 border border-stone-200 rounded-xl p-3 text-xs text-stone-500 outline-none focus:border-orange-500 transition">
            </div>
            <div class="flex gap-3 mt-6">
                <button v-if="isEditing" @click="deleteActivity" class="flex-1 bg-red-50 text-red-500 py-3 rounded-xl font-bold hover:bg-red-100 transition">åˆªé™¤</button>
                <button @click="showModal = false" class="flex-1 bg-stone-100 text-stone-500 py-3 rounded-xl font-medium hover:bg-stone-200 transition">å–æ¶ˆ</button>
                <button @click="saveActivity" class="flex-[2] bg-orange-600 text-white py-3 rounded-xl font-bold hover:bg-orange-700 shadow-lg shadow-orange-200 transition">å„²å­˜</button>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp } = Vue;

    const detailedData = {
        0: [
            { id: 1, time: '16:50', location: 'é—œè¥¿æ©Ÿå ´ T2', action: 'è½‰æ­æ¥é§å·´å£«', transport: 'å…è²»å·´å£« â†’ Aeroplaza', 
              transport_detail: 'å…¥å¢ƒå¾Œï¼Œè«‹è·Ÿéš¨ã€ŒShuttle Bus to T1/Railwaysã€æŒ‡æ¨™ã€‚\næ­ä¹˜å…è²»æ¥é§å·´å£«ç´„ 7-10 åˆ†é˜ï¼Œä¸‹è»Šå¾Œä¸Šæ¨“å³ç‚º Aeroplaza/é›»è»Šç«™ã€‚\nè«‹é ç•™æ™‚é–“è³¼ç¥¨/å…Œæ›ã€‚',
              link: 'https://www.google.com/maps/search/?api=1&query=Aeroplaza+Kansai+Airport' },
            { id: 2, time: '17:35', location: 'é—œè¥¿æ©Ÿå ´ç«™', action: 'å—æµ·ç‰¹æ€¥ Rapi:t Î±', transport: '17:35 ç™¼è»Š (å…¨è»ŠæŒ‡å®šå¸­)', 
              transport_detail: 'â˜… æ™‚åˆ»ç¢ºèªï¼š17:35 ç™¼è»Šã€‚\n1. å”®ç¥¨ï¼šå—æµ·é›»éµæ«ƒæª¯ (Nankai)ã€‚\n2. åˆ—è»Šï¼šæ·±è—è‰²éµäºº28è™Ÿè»Šé ­ï¼Œå…¨è»Šå°è™Ÿåº§ã€‚\n3. ä¸‹è»Šç«™ï¼šå—æµ·é›£æ³¢ç«™ (ç´„ 18:14 æŠµé”)ã€‚',
              link: 'https://www.google.com/maps/search/?api=1&query=Nankai+Kansai+Airport+Station' },
            { id: 3, time: '18:15', location: 'å—æµ·é›£æ³¢ç«™', action: 'å‡ºç«™æ­¥è¡Œ (é—œéµ)', transport: 'æ­¥è¡Œ (ç´„10-12åˆ†)', 
              transport_detail: '1. ä¸‹è»Šå¾Œï¼Œè«‹å‹™å¿…æ­æ‰‹æ‰¶æ¢¯ä¸‹åˆ° 1F (åŒ—å‡ºå£/æ±å‡ºå£)ã€‚\n2. å¼·çƒˆå»ºè­°èµ°ã€Œåœ°é¢é“è·¯ã€ï¼Œåœ°ä¸‹è¡—å¾ˆå®¹æ˜“è¿·è·¯ã€‚\n3. å‡ºç«™å¾Œå¾€å³å‰æ–¹çš„ã€Œå—æµ·é€šã€æˆ–è·Ÿè‘—å°èˆªå¾€ã€Œé»‘é–€å¸‚å ´ã€æ–¹å‘èµ°ã€‚',
              link: 'https://www.google.com/maps/search/?api=1&query=Namba+Station+Nankai' },
            { id: 4, time: '18:30', location: 'å¤§é˜ªå‡±æ‚…å˜‰è–ˆ', action: 'Check-in', transport: 'æ­¥è¡Œ', isHotel: true, note: 'é£¯åº—ä½æ–¼é»‘é–€å¸‚å ´æ—ï¼Œè¾¦ç†å…¥ä½æ‰‹çºŒã€‚', link: 'https://www.google.com/maps/search/?api=1&query=Caption+by+Hyatt+Namba+Osaka' },
            { id: 5, time: '19:15', location: 'é“é “å € / é›£æ³¢', action: 'æ™šé¤ & é€›è¡—', transport: 'æ­¥è¡Œ', note: 'ç¨ä½œä¼‘æ¯å¾Œï¼Œæ­¥è¡Œè‡³é“é “å €ç”¨é¤ã€‚', link: 'https://www.google.com/maps/search/?api=1&query=Dotonbori+Glico+Sign',
                foodOptions: [
                    { name: 'ç¦å¤ªéƒ æœ¬åº—', desc: 'ç±³å…¶æ—æ¨è–¦å¤§é˜ªç‡’ï¼Œè«‹èªæ˜æœ¬åº—', link: 'https://www.google.com/maps/search/?api=1&query=Fukutaro+Honten+Osaka' },
                    { name: 'ç‡’è‚‰åŠ›ä¸¸ é›£æ³¢é“é “å €åº—', desc: 'åœ‹ç”¢ç‰›åƒåˆ°é£½ï¼Œè¦ªå­å‹å–„', link: 'https://www.google.com/maps/search/?api=1&query=Yakiniku+Rikimaru+Namba+Dotonbori' },
                    { name: 'ç¥åº§æ‹‰éºµ é“é “å €åº—', desc: 'å¤§é‡è”¬èœæ¸…çˆ½æ¹¯é ­ï¼Œä¸æ²¹è†©', link: 'https://www.google.com/maps/search/?api=1&query=Kamukura+Dotonbori' }
                ],
                shopping: { name: 'Donki é“é “å €åº—', desc: 'æ‘©å¤©è¼ªä¸‹é‚£é–“ï¼Œåœ°æ¨™æ˜é¡¯', link: 'https://www.google.com/maps/search/?api=1&query=Don+Quijote+Dotonbori' }
            }
        ],
        1: [
            { id: 7, time: '09:00', location: 'é£¯åº— â†’ æ—¥æœ¬æ©‹ç«™', action: 'ç§»å‹•è‡³ç¥æˆ¶', transport: 'é˜ªç¥é›»è»Š (ç›´é”)', 
              transport_detail: '1. é€²ç«™ï¼šè¿‘éµ/é˜ªç¥æ—¥æœ¬æ©‹ç«™ (å¾åœ°ä¸‹è¡— B28/B29 å…¥å£è¼ƒè¿‘)ã€‚\n2. ç¥¨åˆ¸ï¼šåˆ· IC å¡ (Suica/ICOCA) å³å¯ï¼Œä¸ç”¨è²·ç‰¹æ€¥åˆ¸ã€‚\n3. æœˆå°ï¼šè·Ÿéš¨ã€Œé˜ªç¥é›»è»Šã€æŒ‡æ¨™ã€‚\n4. åˆ—è»Šï¼šè«‹æ­ã€Œå¿«é€Ÿæ€¥è¡Œ (Rapid Express)ã€å¾€ã€Œç¥æˆ¸ä¸‰å®®ã€ã€‚',
              link: 'https://www.google.com/maps/search/?api=1&query=Kintetsu+Nippombashi+Station' },
            { id: 9, time: '10:00', location: 'ç¥æˆ¶ä¸‰å®®', action: 'å¸‚å€é€›é€›', transport: 'æ­¥è¡Œ', note: 'æŠµé”ä¸‰å®®ï¼Œé€›é€›è»Šç«™å‘¨é‚Šï¼Œæ„Ÿå—ç¥æˆ¶æ°£æ°›ã€‚', tip: 'ä»Šå¤©é‡é»æ˜¯åƒç‰›æ’å’Œçœ‹æµ·ï¼Œè¡Œç¨‹å¾ˆé¬†ã€‚' },
            { id: 11, time: '11:30', location: 'ä¸‰å®®å¸‚å€', action: 'ç¥æˆ¶ç‰›åˆé¤', transport: 'æ­¥è¡Œ', note: 'é‡é ­æˆ²ï¼å»ºè­°ææ—©å»æ’éšŠæˆ–é ç´„ã€‚', link: 'https://www.google.com/maps/search/?api=1&query=Kobe+Sannomiya+Station',
                foodOptions: [
                    { name: 'Mouriya æœ¬åº—', desc: 'é ‚ç´šç¥æˆ¶ç‰›éµæ¿ç‡’ (éœ€é ç´„)', link: 'https://www.google.com/maps/search/?api=1&query=Mouriya+Honten+Kobe' },
                    { name: 'Steakland ç¥æˆ¶é¤¨', desc: 'é«˜CPå€¼ï¼Œç©ºé–“å¤§é©åˆå®¶åº­', link: 'https://www.google.com/maps/search/?api=1&query=Steakland+Kobekan' },
                    { name: 'Red Rock æœ¬åº—', desc: 'å †æˆå±±çš„çƒ¤ç‰›è‚‰ä¸¼é£¯', link: 'https://www.google.com/maps/search/?api=1&query=Red+Rock+Sannomiya' }
                ]
            },
            { id: 12, time: '14:00', location: 'ä¸‰å®® â†’ ç¥æˆ¶æ¸¯', action: 'ç§»å‹•', transport: 'Uber / Taxi', recommend: true, 
              transport_detail: '1. å«è»Šï¼šè¨­å®šç›®çš„åœ°ç‚ºã€ŒUmie Mosaicã€ã€‚\n2. è²»ç”¨ï¼šç´„ 1200-1500 æ—¥åœ“ã€‚\n3. ç†ç”±ï¼šé€™æ®µè·¯å¦‚æœæ­é›»è»Šè¦èµ°å¾ˆä¹…ï¼Œå…¨å®¶æ­è¨ˆç¨‹è»Šæœ€åˆ’ç®—çœåŠ›ã€‚',
              link: 'https://www.google.com/maps/search/?api=1&query=Kobe+Harborland+umie+Mosaic' },
            { id: 13, time: '14:30', location: 'ç¥æˆ¶æ¸¯ (Mosaic)', action: 'é€›è¡— & ä¸‹åˆèŒ¶', transport: 'æ­¥è¡Œ', note: 'é€™è£¡æœ‰éºµåŒ…è¶…äººåšç‰©é¤¨(å•†åº—å…è²»é€²)ã€Umie å•†å ´ï¼Œæµ·æ™¯å¾ˆç¾ã€‚', link: 'https://www.google.com/maps/search/?api=1&query=Kobe+Anpanman+Childrens+Museum' },
            { id: 14, time: '17:30', location: 'Mosaic â†’ é«˜é€Ÿç¥æˆ¶', action: 'å›ç¨‹', transport: 'æ­¥è¡Œ / Uber', 
              transport_detail: '1. æ­¥è¡Œï¼šç©¿è¶Š Umie å•†å ´åœ°ä¸‹è¡—å¯é€šå¾€ã€Œé«˜é€Ÿç¥æˆ¶ç«™ã€(ç´„ 10-15 åˆ†)ã€‚\n2. è‹¥ç´¯äº†ï¼šç›´æ¥è¨ˆç¨‹è»Šååˆ°ä¸‰å®®ç«™ï¼Œæˆ–ç›´æ¥åå›æ—¥æœ¬æ©‹(è¼ƒè²´ä½†èˆ’é©)ã€‚',
              link: 'https://www.google.com/maps/search/?api=1&query=Kosoku+Kobe+Station' },
            { id: 15, time: '19:00', location: 'é›£æ³¢ / æ—¥æœ¬æ©‹', action: 'æ™šé¤', transport: 'é˜ªç¥é›»è»Š (ç›´é”)', 
              transport_detail: 'å›ç¨‹åŒæ¨£æ­ä¹˜é˜ªç¥é›»è»Šã€Œå¿«é€Ÿæ€¥è¡Œã€å¾€ã€Œå¥ˆè‰¯ã€æˆ–ã€Œé›£æ³¢ã€æ–¹å‘ï¼Œåœ¨ã€Œè¿‘éµæ—¥æœ¬æ©‹ã€ä¸‹è»Šã€‚',
              foodOptions: [
                    { name: 'å¤©æ”¿ (Tenmasa)', desc: 'å¹³åƒ¹å¥½åƒçš„å¤©å©¦ç¾…çƒé¾éºµ', link: 'https://www.google.com/maps/search/?api=1&query=Tenmasa+Namba' },
                    { name: 'åƒæˆ¿ é“é “å €å¤§æ¨“åº—', desc: 'ç’°å¢ƒèˆ’é©çš„å¤§é˜ªç‡’ååº—', link: 'https://www.google.com/maps/search/?api=1&query=Chibo+Dotonbori+Building' },
                    { name: 'å¤§èµ·æ°´ç”¢ é“é “å €åº—', desc: 'æ–°é®®å¹³åƒ¹ï¼Œè¿´è½‰å£½å¸', link: 'https://www.google.com/maps/search/?api=1&query=Daiki+Suisan+Dotonbori' }
                ],
                shopping: { name: 'æ¾æœ¬æ¸… å¿ƒé½‹æ©‹å—åº—', desc: 'è²¨å“é½Šå…¨ï¼Œä½ç½®æ–¹ä¾¿', link: 'https://www.google.com/maps/search/?api=1&query=Matsumoto+Kiyoshi+Shinsaibashi+Minami' }
            }
        ],
        2: [
            { id: 16, time: '09:30', location: 'é»‘é–€å¸‚å ´', action: 'æ—©åˆé¤', transport: 'æ­¥è¡Œ', note: 'é£¯åº—æ—åƒåƒå–å–ï¼Œè²·é»æ°´æœã€‚', link: 'https://www.google.com/maps/search/?api=1&query=Kuromon+Ichiba+Market' },
            { id: 17, time: '11:00', location: 'é£¯åº— â†’ æ·€å±‹æ©‹', action: 'ç§»å‹•è‡³äº¬éƒ½', transport: 'Uber / Taxi', recommend: true, 
              transport_detail: '1. å«è»Šï¼šè«‹é£¯åº—æ«ƒæª¯å«è»Šæˆ–ç”¨ Uberã€‚\n2. ç›®çš„åœ°ï¼šäº¬é˜ªé›»è»Š æ·€å±‹æ©‹ç«™ (Keihan Yodoyabashi Station)ã€‚\n3. ç†ç”±ï¼šæ‹–è‘—å¤§è¡Œæå»æ­åœ°éµè½‰è»Šå¤ªç´¯ï¼Œè¨ˆç¨‹è»Šç›´é”èµ·ç«™æœ€æ–¹ä¾¿ã€‚',
              link: 'https://www.google.com/maps/search/?api=1&query=Yodoyabashi+Station+Keihan' },
            { id: 18, time: '11:30', location: 'æ·€å±‹æ©‹ â†’ ç¥å®®ä¸¸å¤ªç”º', action: 'äº¬é˜ªç‰¹æ€¥', transport: 'äº¬é˜ªé›»è»Š (Premium Car)', 
              transport_detail: 'â˜…å»ºè­°åŠ è³¼ Premium Car (ç¬¬6è»Šå»‚)ã€‚\n1. åˆ—è»Šï¼šæ­ä¹˜ç´…é»ƒé…è‰²çš„ã€Œç‰¹æ€¥ã€ã€‚\n2. è³¼ç¥¨ï¼šåˆ· IC å¡é€²ç«™å¾Œï¼Œåœ¨æœˆå°å”®ç¥¨æ©ŸåŠ è²·æŒ‡å®šå¸­åˆ¸ (ç´„500æ—¥åœ“)ã€‚\n3. ä¸‹è»Šç«™ï¼šç¥å®®ä¸¸å¤ªç”º (Jingu-Marutamachi)ã€‚',
              link: 'https://www.google.com/maps/search/?api=1&query=Jingu-Marutamachi+Station' },
            { id: 19, time: '12:30', location: 'ç¥å®®ä¸¸å¤ªç”º â†’ é£¯åº—', action: 'Check-in', transport: 'Uber / Taxi', isHotel: true, 
              transport_detail: 'å‡ºç«™å¾Œï¼Œç›´æ¥æ‹›è¨ˆç¨‹è»Šæˆ– Uber å‰å¾€é£¯åº—ã€‚è·é›¢ä¸é ï¼Œä½†è·¯é¢å¯èƒ½ä¸é©åˆæ‹–è¡Œæèµ°å¤ªä¹…ã€‚',
              link: 'https://www.google.com/maps/search/?api=1&query=Hyatt+Place+Kyoto' },
            { id: 20, time: '13:30', location: 'éŒ¦å¸‚å ´ / å››æ¢', action: 'åˆé¤', transport: 'Uber / åœ°éµ', note: 'æ”¾å¥½è¡Œæï¼Œå»éŒ¦å¸‚å ´å‘¨é‚Šè¦“é£Ÿã€‚', 
                foodOptions: [
                    { name: 'ä¸€é¢¨å ‚ éŒ¦å°è·¯åº—', desc: 'å“è³ªç©©å®šçš„æ‹‰éºµ', link: 'https://www.google.com/maps/search/?api=1&query=Ippudo+Nishikikoji' },
                    { name: 'éŒ¦ Warai', desc: 'äº¬é¢¨å¤§é˜ªç‡’ï¼Œç‚’éºµä¹Ÿå¥½åƒ', link: 'https://www.google.com/maps/search/?api=1&query=Nishiki+Warai+Nishiki+Honten' },
                    { name: 'å¤§æˆ¶å±‹ äº¬éƒ½éŒ¦å°è·¯åº—', desc: 'å®šé£Ÿ/å…’ç«¥é¤ï¼Œå®‰å…¨ç‰Œ', link: 'https://www.google.com/maps/search/?api=1&query=Ootoya+Kyoto+Nishikikoji' }
                ]
            },
            { id: 21, time: '15:30', location: 'å››æ¢æ²³åŸç”º', action: 'é€›è¡—', transport: 'æ­¥è¡Œ', note: 'é«˜å³¶å±‹ã€Disney Store éƒ½åœ¨é€™ã€‚', shopping: { name: 'æ¾æœ¬æ¸… äº¬éƒ½å››æ¢æ²³åŸç”º', desc: 'äº¬éƒ½è£œè²¨é»', link: 'https://www.google.com/maps/search/?api=1&query=Matsumoto+Kiyoshi+Kyoto+Shijo+Kawaramachi' } },
            { id: 22, time: '18:00', location: 'å››æ¢ / çƒä¸¸', action: 'æ™šé¤', transport: 'æ­¥è¡Œ', note: 'æ™šé¤æ™‚åˆ»ã€‚',
                foodOptions: [
                    { name: 'åä»£ç‚¸è±¬æ’ Katsukura ä¸‰æ¡æœ¬åº—', desc: 'äº¬éƒ½ç¬¬ä¸€è±¬æ’', link: 'https://www.google.com/maps/search/?api=1&query=Katsukura+Sanjo+Honten' },
                    { name: 'éºµå±‹ è±¬ä¸€ (Inoichi)', desc: 'å¿…æ¯”ç™»æ¨ä»‹ï¼Œæ¸…æ·¡ç³»æ‹‰éºµ', link: 'https://www.google.com/maps/search/?api=1&query=Menya+Inoichi' },
                    { name: 'æœ¬å®¶å°¾å¼µå±‹ æœ¬åº—', desc: '500å¹´æ­·å²è•éº¥éºµ', link: 'https://www.google.com/maps/search/?api=1&query=Honke+Owariya+Main+Branch' }
                ]
            }
        ],
        3: [
            { id: 23, time: '08:30', location: 'é£¯åº— â†’ ä¼è¦‹ç¨»è·', action: 'åƒæœ¬é³¥å±…', transport: 'Uber', recommend: true, 
              transport_detail: '1. å«è»Šï¼šUber ç›´é”ã€Œä¼è¦‹ç¨»è·å¤§ç¤¾ åœè»Šå ´ã€ã€‚\n2. ç†ç”±ï¼šé€™æ®µå¦‚æœæ­åœ°éµè¦è½‰è»Šä¸”äººå¤šï¼Œè¨ˆç¨‹è»Šç´„ 20 åˆ†é˜æœ€èˆ’æœï¼Œå¯ä»¥ä¿ç•™é«”åŠ›çˆ¬å±±ã€‚',
              link: 'https://www.google.com/maps/search/?api=1&query=Fushimi+Inari+Taisha' },
            { id: 24, time: '10:30', location: 'ä¼è¦‹ç¨»è· â†’ æ¸…æ°´å¯º', action: 'ç§»å‹•', transport: 'Uber', recommend: true, 
              transport_detail: '1. å«è»Šï¼šè¨­å®šç›®çš„åœ°ç‚ºã€Œæ¸…æ°´é“ (Kiyomizu-michi)ã€å…¬è»Šç«™é™„è¿‘ï¼Œæˆ–ã€Œäº”æ¢å‚ã€ã€‚\n2. æ³¨æ„ï¼šè¨ˆç¨‹è»Šé–‹ä¸é€²æ¸…æ°´å¯ºæ­£é–€å£ï¼Œéœ€è¦åœ¨å¡é“ä¸‹æ–¹ä¸‹è»Šé–‹å§‹èµ°ã€‚',
              link: 'https://www.google.com/maps/search/?api=1&query=Kiyomizu-michi+Bus+Stop' },
            { id: 25, time: '12:00', location: 'æ¸…æ°´å¯ºå‘¨é‚Š', action: 'åˆé¤', transport: 'æ­¥è¡Œ', note: 'åƒæ‹œå®Œå¾Œåœ¨é™„è¿‘ç”¨é¤ã€‚', 
                foodOptions: [
                    { name: 'å¥§ä¸¹æ¸…æ°´', desc: '300å¹´æ¹¯è±†è…è€åº—', link: 'https://www.google.com/maps/search/?api=1&query=Okutan+Kiyomizu' },
                    { name: 'æ¸…æ°´é †æ­£ Okabeya', desc: 'æ¹¯è±†è…èˆ‡äº¬éƒ½æ–™ç†', link: 'https://www.google.com/maps/search/?api=1&query=Kiyomizu+Junsei+Okabeya' },
                    { name: 'å‰é‡å®¶ æ¸…æ°´å¯ºåº—', desc: 'å¿«é€Ÿè§£æ±ºï¼Œå°å­©æ„›åƒç‰›ä¸¼', link: 'https://www.google.com/maps/search/?api=1&query=Yoshinoya+Kiyomizudera' }
                ]
            },
            { id: 26, time: '14:30', location: 'æ¸…æ°´å¯º â†’ ç¥‡åœ’', action: 'ä¸‹å¡æ•£æ­¥', transport: 'æ­¥è¡Œ', note: 'ä¸‰å¹´å‚ â†’ äºŒå¹´å‚ â†’ å…«å‚ç¥ç¤¾ï¼Œä¸€è·¯ä¸‹å¡é€›è¡—ã€‚', link: 'https://www.google.com/maps/search/?api=1&query=Yasaka+Shrine' },
            { id: 27, time: '18:00', location: 'ç¥‡åœ’ / æ²³åŸç”º', action: 'æ™šé¤', transport: 'æ­¥è¡Œ', note: 'æœ€å¾Œä¸€æ™šçš„æ™šé¤ã€‚',
                foodOptions: [
                    { name: 'ç¥‡åœ’ Tanto', desc: 'é´¨å·æ—éµæ¿ç‡’', link: 'https://www.google.com/maps/search/?api=1&query=Gion+Tanto' },
                    { name: 'æŸšå­å…ƒ (Pontocho)', desc: 'äººæ°£æŸšå­ç«é‹', link: 'https://www.google.com/maps/search/?api=1&query=Yuzugen+Pontocho' },
                    { name: 'å£½å¸ä¹‹æ­¦è— ä¸‰æ¡æœ¬åº—', desc: 'è€ç‰Œè¿´è½‰å£½å¸', link: 'https://www.google.com/maps/search/?api=1&query=Sushi+no+Musashi+Sanjo+Honten' }
                ],
                shopping: { name: 'Donki äº¬éƒ½æ²³åŸç”ºåº—', desc: 'æœ€å¾Œè£œè²¨æ©Ÿæœƒ', link: 'https://www.google.com/maps/search/?api=1&query=Don+Quijote+Kyoto+Kawaramachi' }
            },
            { id: 28, time: '20:00', location: 'æ²³åŸç”º â†’ é£¯åº—', action: 'å›ç¨‹', transport: 'Uber', 
              transport_detail: 'é€›å®Œè¡—é€šå¸¸å¤§åŒ…å°åŒ…ï¼Œç›´æ¥åœ¨å››æ¢æ²³åŸç”ºè·¯é‚Šå« Uber å›é£¯åº—ã€‚',
              link: 'https://www.google.com/maps/search/?api=1&query=Hyatt+Place+Kyoto' }
        ],
        4: [
            { id: 29, time: '08:05', location: 'é£¯åº— â†’ äº¬éƒ½ç«™', action: 'å‰å¾€è»Šç«™', transport: 'Uber', recommend: true, 
              transport_detail: 'â˜…é—œéµï¼šè«‹è¨­å®šç›®çš„åœ°ç‚ºäº¬éƒ½ç«™ã€Œå…«æ¢å£ (Hachijo Exit)ã€ã€‚\nç›®æ¨™æ­ä¹˜ 08:45 çš„è»Šï¼Œå»ºè­° 08:05-08:10 å¾é£¯åº—å‡ºç™¼ï¼Œé ç•™æ™‚é–“æ‰¾æœˆå°ã€‚',
              link: 'https://www.google.com/maps/search/?api=1&query=Kyoto+Station+Hachijo+Exit' },
            { id: 30, time: '08:45', location: 'äº¬éƒ½ç«™ â†’ æ©Ÿå ´', action: 'Haruka ç‰¹æ€¥', transport: '08:45 ç™¼è»Š (JR ç‰¹æ€¥)', 
              transport_detail: 'â˜… æ™‚åˆ»ç¢ºèªï¼š08:45 ç™¼è»Š (30è™Ÿæœˆå°)ã€‚\n1. é€²ç«™ï¼šå¾å…«æ¢å£é€² JR æ”¹æœ­å£ã€‚\n2. ç¥¨å‹™ï¼šè«‹å‹™å¿…äº‹å…ˆåŠƒå¥½ã€ŒæŒ‡å®šå¸­ (Reserved)ã€ï¼Œä¸è¦æ­è‡ªç”±å¸­ã€‚\n3. æ™‚é–“ï¼šè»Šç¨‹ 80 åˆ†é˜ï¼Œç´„ 10:05 æŠµé”æ©Ÿå ´ã€‚',
              link: 'https://www.google.com/maps/search/?api=1&query=Kyoto+Station+Platform+30' },
            { id: 31, time: '10:05', location: 'é—œè¥¿æ©Ÿå ´ T1 â†’ T2', action: 'è½‰æ­æ¥é§è»Š', transport: 'æ¥é§å·´å£«', 
              transport_detail: 'Haruka åœé  T1ã€‚å‡ºç«™å¾Œï¼Œèµ°éå¤©æ©‹åˆ° Aeroplazaï¼Œæ­ä¹˜å…è²»æ¥é§å·´å£«å‰å¾€ T2 (å»‰èˆªèˆªå»ˆ)ã€‚',
              link: 'https://www.google.com/maps/search/?api=1&query=Aeroplaza+Kansai+Airport', 
                foodOptions: [
                    { name: 'æ©Ÿå ´ç¾é£Ÿè¡—', desc: 'T1/Aeroplaza æœ‰å¾ˆå¤šé¸æ“‡', link: '#' },
                    { name: 'ä¾¿åˆ©å•†åº—', desc: 'æœ€å¾Œè²·å€‹é£¯ç³°ä¸Šé£›æ©Ÿ', link: '#' }
                ] 
            },
            { id: 32, time: '12:00', location: 'å›ç¨‹', action: 'Safe Flight', transport: 'é£›æ©Ÿ', note: 'æ—…é€”æ„‰å¿«ï¼' }
        ]
    };

    const app = createApp({
        data() {
            return {
                currentDay: 0,
                currentView: 'list',
                showModal: false,
                isEditing: false,
                mapInstance: null,
                days: [
                    { date: '12/12 (äº”)', name: 'Day 1: æŠµé”å¤§é˜ª', desc: 'é“é “å €ç¾é£Ÿ', center: [34.6687, 135.5013], weather: { status: 'æ™´æ™‚å¤šé›²', icon: 'fas fa-sun', temp_high: 11, temp_low: 5, color: 'text-orange-500', rain: false } },
                    { date: '12/13 (å…­)', name: 'Day 2: ç¥æˆ¶ç²¾è¯', desc: 'ç‰›æ’ & æµ·æ¸¯', center: [34.6901, 135.1955], weather: { status: 'å¤šé›²æ™‚é™°', icon: 'fas fa-cloud', temp_high: 11, temp_low: 4, color: 'text-gray-500', rain: false } },
                    { date: '12/14 (æ—¥)', name: 'Day 3: ç§»å‹•äº¬éƒ½', desc: 'éŒ¦å¸‚å ´ & è±¬æ’', center: [35.0037, 135.7592], weather: { status: 'é™°çŸ­æš«é›¨', icon: 'fas fa-cloud-rain', temp_high: 14, temp_low: 7, color: 'text-blue-500', rain: true } },
                    { date: '12/15 (ä¸€)', name: 'Day 4: æ¸…æ°´å¯º', desc: 'æ¹¯è±†è… & éµæ¿ç‡’', center: [34.9949, 135.7850], weather: { status: 'å¤šé›²', icon: 'fas fa-cloud', temp_high: 11, temp_low: 6, color: 'text-gray-500', rain: false } },
                    { date: '12/16 (äºŒ)', name: 'Day 5: è¿”ç¨‹', desc: 'Haruka 08:45', center: [34.4320, 135.2304], weather: { status: 'æ™´æœ—', icon: 'fas fa-sun', temp_high: 12, temp_low: 4, color: 'text-orange-500', rain: false } }
                ],
                activities: {},
                form: { id: null, time: '', location: '', action: '', transport: '', note: '', transport_detail: '', link: '', isHotel: false, tip: '', recommend: false }
            }
        },
        computed: {
            currentActivities() {
                return this.activities[this.currentDay] || [];
            },
            sortedActivities() {
                return [...this.currentActivities].sort((a, b) => a.time.localeCompare(b.time));
            }
        },
        mounted() {
            this.loadAndMergeData();
        },
        methods: {
            loadAndMergeData() {
                try {
                    const saved = localStorage.getItem('japanTrip_v23_Time_Confirm');
                    if (saved) {
                        this.activities = JSON.parse(saved);
                    } else {
                        this.activities = JSON.parse(JSON.stringify(detailedData));
                        this.saveToStorage();
                    }
                } catch(e) {
                    this.activities = JSON.parse(JSON.stringify(detailedData));
                }
            },
            changeDay(index) {
                this.currentDay = index;
                this.currentView = 'list';
            },
            switchMap() {
                this.currentView = 'map';
                this.$nextTick(() => {
                    if (!this.mapInstance) this.initMap();
                    setTimeout(() => {
                        this.mapInstance.invalidateSize();
                        this.mapInstance.setView(this.days[this.currentDay].center, 14);
                    }, 100);
                });
            },
            initMap() {
                this.mapInstance = L.map('map').setView(this.days[this.currentDay].center, 14);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                    attribution: 'OpenStreetMap', maxZoom: 19
                }).addTo(this.mapInstance);
            },
            openSmartMap(item) {
                if (item.link) window.open(item.link, '_blank');
            },
            getIconColor(item) {
                if (item.isHotel) return 'bg-purple-500';
                if (item.recommend) return 'bg-black border-black'; 
                if (item.transport) return 'bg-blue-600'; 
                return 'bg-stone-300';
            },
            isKeyTime(time) {
                return (time === '17:35' || time === '08:45');
            },
            openModal(item = null) {
                this.isEditing = !!item;
                this.form = item ? { ...item } : { id: Date.now(), time: '09:00', location: '', action: '', transport: '', note: '', transport_detail: '', link: '', isHotel: false, tip: '', recommend: false };
                this.showModal = true;
            },
            saveActivity() {
                if (!this.form.location) return alert('è«‹è¼¸å…¥åœ°é»');
                if (!this.activities[this.currentDay]) this.activities[this.currentDay] = [];
                
                if (this.isEditing) {
                    const idx = this.activities[this.currentDay].findIndex(x => x.id === this.form.id);
                    if (idx !== -1) this.activities[this.currentDay][idx] = { ...this.form };
                } else {
                    this.activities[this.currentDay].push({ ...this.form });
                }
                this.saveToStorage();
                this.showModal = false;
            },
            deleteActivity() {
                if(confirm('åˆªé™¤æ­¤è¡Œç¨‹ï¼Ÿ')) {
                    this.activities[this.currentDay] = this.activities[this.currentDay].filter(x => x.id !== this.form.id);
                    this.saveToStorage();
                    this.showModal = false;
                }
            },
            saveToStorage() {
                localStorage.setItem('japanTrip_v23_Time_Confirm', JSON.stringify(this.activities));
            },
            resetData() {
                if(confirm('é‡ç½®å°‡æ¢å¾©ç‚ºã€Œv23 æ™‚åˆ»è¡¨ç¢ºèªç‰ˆã€ã€‚ç¢ºå®šå—ï¼Ÿ')) {
                    this.activities = JSON.parse(JSON.stringify(detailedData));
                    this.saveToStorage();
                    this.currentDay = 0;
                    alert('å·²æ›´æ–°ç‚ºæ™‚åˆ»ç¢ºèªç‰ˆ (v23)ï¼');
                }
            }
        }
    });
    
    app.mount('#app');
</script>

<style>
@keyframes bounce-up { 0% { transform: translateY(20px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
.animate-bounce-up { animation: bounce-up 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
</style>

</body>
</html>
