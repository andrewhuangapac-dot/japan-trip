<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº¬é˜ªç¥ 5 æ—¥å…¨å°èˆªç‰ˆ</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>

    <style>
        body { background-color: #f3f4f6; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        #map { height: 100%; width: 100%; z-index: 1; }
        [v-cloak] { display: none; }
    </style>
</head>
<body>

<div id="app" v-cloak class="max-w-md mx-auto bg-white min-h-screen relative shadow-2xl flex flex-col">
    
    <header class="bg-gradient-to-br from-indigo-700 to-blue-800 text-white p-5 pb-4 rounded-b-[2rem] shadow-xl z-20">
        <div class="flex justify-between items-center mb-4">
            <div>
                <h1 class="text-xl font-bold tracking-wide">äº¬é˜ªç¥æ·±åº¦éŠ ğŸ‡¯ğŸ‡µ</h1>
                <p class="text-blue-200 text-xs mt-1"><i class="fas fa-map-signs mr-1"></i>å…¨è·¯ç·šå°èˆªç‰ˆ</p>
            </div>
            <button @click="resetData" class="text-xs bg-white/10 border border-white/20 px-3 py-1.5 rounded-full hover:bg-white/30 transition backdrop-blur-sm">é‡ç½®è¡Œç¨‹</button>
        </div>
        <div class="flex space-x-2 overflow-x-auto no-scrollbar pb-1">
            <button v-for="(day, index) in days" :key="index" @click="changeDay(index)"
                :class="currentDay === index ? 'bg-white text-indigo-800 font-bold shadow-lg scale-105' : 'bg-indigo-900/40 text-blue-100 hover:bg-indigo-800/60'"
                class="px-4 py-2.5 rounded-xl text-sm whitespace-nowrap transition-all flex-shrink-0 mb-2">
                {{ day.shortName }}
            </button>
        </div>
    </header>

    <main class="flex-1 relative bg-gray-50 overflow-hidden">
        
        <div v-show="currentView === 'list'" class="h-full overflow-y-auto pb-24 px-4 pt-5 no-scrollbar">
            <div class="mb-4 ml-2 flex justify-between items-end">
                <div>
                    <h2 class="text-xl font-bold text-gray-800">{{ days[currentDay].name }}</h2>
                    <p class="text-xs text-gray-500 mt-1"><i class="fas fa-info-circle mr-1"></i>é»æ“Šç¶ è‰²æŒ‰éˆ•é–‹å•Ÿè·¯ç·šåœ–</p>
                </div>
            </div>

            <div class="space-y-5 pb-20">
                <div v-for="item in sortedActivities" :key="item.id" class="relative pl-6 border-l-[3px] border-indigo-100 last:border-0">
                    <div class="absolute -left-[10px] top-5 w-5 h-5 rounded-full border-4 border-white shadow-sm"
                         :class="item.transport ? 'bg-blue-500' : 'bg-gray-300'"></div>
                    
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow group">
                        <div class="flex justify-between items-start">
                            <div class="flex-1 mr-3">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="bg-indigo-50 text-indigo-700 text-[11px] font-bold px-2 py-0.5 rounded">{{ item.time }}</span>
                                    <span v-if="item.transport" class="text-[10px] text-blue-600 bg-blue-50 px-1.5 py-0.5 rounded border border-blue-100">
                                        <i class="fas fa-train mr-1"></i>ç§»å‹•
                                    </span>
                                </div>
                                <h3 class="font-bold text-gray-800 text-[15px] leading-tight">{{ item.location }}</h3>
                                <p class="text-gray-600 text-sm mt-1 font-medium">{{ item.action }}</p>
                                
                                <div v-if="item.transport" class="mt-2.5 p-2.5 bg-blue-50/50 rounded-xl border border-blue-100/50">
                                    <p class="text-xs text-blue-800 font-semibold mb-1">
                                        <i class="fas fa-subway mr-1.5 w-3"></i>{{ item.transport }}
                                    </p>
                                    <p v-if="item.note" class="text-[11px] text-gray-600 leading-relaxed pl-5 border-l-2 border-blue-200 ml-1">
                                        {{ item.note }}
                                    </p>
                                </div>
                                <div v-else-if="item.note" class="mt-2 text-xs text-gray-500 bg-gray-50 p-2 rounded-lg">
                                    <i class="fas fa-comment-alt mr-1 text-gray-400"></i>{{ item.note }}
                                </div>
                            </div>
                            
                            <div class="flex flex-col space-y-3 pt-1">
                                <button @click="openSmartMap(item)" 
                                    :class="item.link ? 'bg-green-500 text-white shadow-green-200 shadow-md hover:bg-green-600' : 'bg-gray-100 text-gray-400'"
                                    class="w-10 h-10 rounded-xl flex items-center justify-center transition-all active:scale-90">
                                    <i :class="item.link ? 'fas fa-location-arrow' : 'fas fa-map-marker-alt'" class="text-sm"></i>
                                </button>
                                <button @click="editActivity(item)" class="w-10 h-10 rounded-xl bg-gray-50 text-gray-400 flex items-center justify-center hover:bg-gray-100 active:scale-90 transition-transform">
                                    <i class="fas fa-pen text-xs"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-show="currentView === 'map'" class="absolute inset-0 z-0">
            <div id="map"></div>
        </div>
    </main>

    <nav class="absolute bottom-0 w-full bg-white/95 backdrop-blur border-t border-gray-100 px-6 py-2 flex justify-between items-center z-30 pb-6 pt-3 shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
        <button @click="currentView = 'list'" :class="currentView === 'list' ? 'text-indigo-600' : 'text-gray-400'" class="flex flex-col items-center w-16 transition-colors">
            <i class="fas fa-list-ul text-lg mb-1"></i><span class="text-[10px] font-medium">è¡Œç¨‹è¡¨</span>
        </button>
        <button @click="openModal()" class="bg-indigo-600 text-white rounded-full w-14 h-14 flex items-center justify-center shadow-lg shadow-indigo-300 -translate-y-5 hover:bg-indigo-700 active:scale-95 transition-all">
            <i class="fas fa-plus text-xl"></i>
        </button>
        <button @click="switchMap" :class="currentView === 'map' ? 'text-indigo-600' : 'text-gray-400'" class="flex flex-col items-center w-16 transition-colors">
            <i class="fas fa-map-marked-alt text-lg mb-1"></i><span class="text-[10px] font-medium">åœ°åœ–æ¦‚è¦½</span>
        </button>
    </nav>

    <div v-if="showModal" class="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/60 p-4 backdrop-blur-[2px] transition-opacity">
        <div class="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl animate-bounce-up">
            <h2 class="text-lg font-bold mb-4 text-gray-800">{{ isEditing ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹' }}</h2>
            <div class="space-y-3">
                <div class="flex gap-3">
                    <input type="time" v-model="form.time" class="w-1/3 bg-gray-50 border border-gray-200 rounded-xl p-3 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 outline-none transition">
                    <input type="text" v-model="form.location" placeholder="åœ°é»åç¨±" class="w-2/3 bg-gray-50 border border-gray-200 rounded-xl p-3 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 outline-none transition">
                </div>
                <input type="text" v-model="form.action" placeholder="æ´»å‹•å…§å®¹ (ä¾‹: åƒæ™šé¤)" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 outline-none transition">
                <input type="text" v-model="form.transport" placeholder="äº¤é€šæ–¹å¼ (é¸å¡«)" class="w-full bg-blue-50/50 border border-blue-100 rounded-xl p-3 focus:border-blue-400 outline-none transition text-blue-800 placeholder-blue-300">
                <textarea v-model="form.note" placeholder="è©³ç´°æ”»ç•¥ / å‚™è¨»" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 h-24 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 outline-none resize-none transition"></textarea>
                <input type="text" v-model="form.link" placeholder="Google Maps å°èˆªé€£çµ (é¸å¡«)" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-2.5 text-xs text-gray-500 focus:border-indigo-500 outline-none">
            </div>
            <div class="flex gap-3 mt-6">
                <button v-if="isEditing" @click="deleteActivity" class="flex-1 bg-red-50 text-red-500 py-3.5 rounded-xl font-bold hover:bg-red-100 transition">åˆªé™¤</button>
                <button @click="showModal = false" class="flex-1 bg-gray-100 text-gray-500 py-3.5 rounded-xl font-medium hover:bg-gray-200 transition">å–æ¶ˆ</button>
                <button @click="saveActivity" class="flex-[2] bg-indigo-600 text-white py-3.5 rounded-xl font-bold shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition">å„²å­˜</button>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp } = Vue;

    // å®Œæ•´çš„ 5 å¤©è¡Œç¨‹è³‡æ–™ (å« 100% äº¤é€šå°èˆªé€£çµ)
    const detailedData = {
        0: [
            { id: 1, time: '16:00', location: 'é–¢è¥¿å›½éš›ç©ºæ¸¯ (KIX)', action: 'æŠµé” & å…¥å¢ƒ', transport: '', note: 'å…¥å¢ƒå¾Œä¸Š2æ¨“ï¼Œéç©ºæ©‹è‡³å°é¢ã€Œå—æµ·é›»éµã€æ«ƒå°(ç´…è‰²æ‹›ç‰Œ)' },
            { id: 2, time: '17:00', location: 'æ©Ÿå ´ â†’ é›£æ³¢ç«™', action: 'æ­ä¹˜ç‰¹æ€¥ Rapi:t', transport: 'å—æµ·é›»éµ ç‰¹æ€¥ Rapi:t', note: 'å¾€é›£æ³¢æ–¹å‘ã€‚æ¨è–¦å…ˆè²·é›»å­ç¥¨æƒç¢¼é€²ç«™ã€‚1æˆ–2è™Ÿæœˆå°ã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Kansai+International+Airport&destination=Namba+Station&travelmode=transit' },
            { id: 3, time: '18:00', location: 'é›£æ³¢ç«™ â†’ é“é “å €', action: 'æ­¥è¡Œè‡³å•†åœˆ', transport: 'æ­¥è¡Œ', note: 'å‡ºç«™å¾Œèµ°åœ°é¢ï¼Œè·Ÿè‘— Glico è·‘è·‘äººå»£å‘Šç‰Œèµ°ã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Namba+Station&destination=Dotonbori&travelmode=walking' },
            { id: 4, time: '19:00', location: 'é“é “å €', action: 'æ™šé¤ & è·‘è·‘äººæ‹ç…§', transport: '', note: 'å¿ƒé½‹æ©‹ç­‹å•†åº—è¡—ã€Glicoçœ‹æ¿æ‹ç…§' },
            { id: 5, time: '20:30', location: 'Donki é“é “å €åº—', action: 'è³¼è²·è£œçµ¦å“', transport: 'æ­¥è¡Œ', note: 'æ‘©å¤©è¼ªé‚£é–“ï¼Œäººå¤šæ³¨æ„é€€ç¨…æ™‚é–“', link: 'https://www.google.com/maps/dir/?api=1&origin=Dotonbori&destination=Don+Quijote+Dotonbori&travelmode=walking' }
        ],
        1: [
            { id: 7, time: '09:00', location: 'å¤§é˜ªé›£æ³¢ â†’ ç¥æˆ¶ä¸‰å®®', action: 'è·¨åŸå¸‚ç§»å‹•', transport: 'é˜ªç¥é›»è»Šã€Œå¿«é€Ÿæ€¥è¡Œã€', note: 'âš ï¸ å‹™å¿…æ­ã€Œå¿«é€Ÿæ€¥è¡Œ (Rapid Exp.)ã€ï¼Œåˆ·ICOCAç›´æ¥é€²ç«™ã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Osaka-Namba+Station&destination=Kobe-Sannomiya+Station&travelmode=transit' },
            { id: 8, time: '10:00', location: 'ä¸‰å®®ç«™ â†’ åŒ—é‡ç•°äººé¤¨', action: 'æ•£æ­¥ä¸Šå¡', transport: 'æ­¥è¡Œ', note: 'å¾ä¸‰å®®ç«™å¾€åŒ—èµ°ï¼Œæ²¿é€”ç¶“éæ˜Ÿå·´å…‹ç•°äººé¤¨åº—ã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Kobe-Sannomiya+Station&destination=Kitano+Ijinkan-gai&travelmode=walking' },
            { id: 9, time: '12:00', location: 'ç¥æˆ¶ç‰›æ’ (Mouriya)', action: 'åˆé¤', transport: 'æ­¥è¡Œ', note: 'å»ºè­°äº‹å…ˆé ç´„å•†æ¥­åˆé¤æ™‚æ®µè¼ƒä¾¿å®œ', link: 'https://www.google.com/maps/dir/?api=1&origin=Kitano+Ijinkan-gai&destination=Mouriya+Sannomiya+Steak&travelmode=walking' },
            { id: 10, time: '14:30', location: 'ä¸‰å®® â†’ ç¥æˆ¶æ¸¯ (Harborland)', action: 'å‰å¾€æ¸¯å€', transport: 'JRç¥æˆ¶ç·š', note: 'æ­åˆ°ã€Œç¥æˆ¶ç«™ã€ä¸‹è»Šï¼Œæ­¥è¡Œè‡³ Umieã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Kobe-Sannomiya+Station&destination=Kobe+Harborland+umie&travelmode=transit' },
            { id: 11, time: '17:30', location: 'ç¥æˆ¶(æˆ–ä¸‰å®®) â†’ å¤§é˜ªé›£æ³¢', action: 'è¿”å›å¤§é˜ª', transport: 'é˜ªç¥é›»è»Šã€Œå¿«é€Ÿæ€¥è¡Œã€', note: 'å›ç¨‹ä¸€æ¨£åˆ·å¡ï¼Œèªæº–å¾€ã€Œé›£æ³¢/å¥ˆè‰¯ã€æ–¹å‘ã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Kobe+Station&destination=Osaka-Namba+Station&travelmode=transit' }
        ],
        2: [
            { id: 14, time: '09:00', location: 'é»‘é–€å¸‚å ´', action: 'æ—©åˆé¤', transport: 'æ­¥è¡Œ', note: 'å¾é›£æ³¢èµ°éå»ç´„ 10 åˆ†é˜ã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Namba+Station&destination=Kuromon+Ichiba+Market&travelmode=walking' },
            { id: 16, time: '11:30', location: 'é›£æ³¢ â†’ äº¬éƒ½ (ç¶“æ¢…ç”°)', action: 'ç§»å‹•è‡³äº¬éƒ½ (å¤§é­”ç‹é—œå¡)', transport: 'åœ°éµå¾¡å ‚ç­‹ç·š + JRæ–°å¿«é€Ÿ', note: '1. é›£æ³¢æ­å¾¡å ‚ç­‹ç·šè‡³ã€Œæ¢…ç”°ã€\n2. è½‰ä¹˜ JRå¤§é˜ªç«™\n3. æ­ã€ŒJRæ–°å¿«é€Ÿã€è‡³äº¬éƒ½ç«™', link: 'https://www.google.com/maps/dir/?api=1&origin=Namba+Station&destination=Kyoto+Station&travelmode=transit' },
            { id: 17, time: '13:00', location: 'äº¬éƒ½ç«™ â†’ ä¸¸å¤ªç”º(é£¯åº—)', action: 'å‰å¾€é£¯åº—æ”¾è¡Œæ', transport: 'åœ°éµçƒä¸¸ç·š', note: 'æ­å¾€ã€Œåœ‹éš›æœƒé¤¨ã€æ–¹å‘ï¼Œç´„7åˆ†é˜ã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Kyoto+Station&destination=Marutamachi+Station&travelmode=transit' },
            { id: 18, time: '15:00', location: 'ä¸¸å¤ªç”º â†’ äº¬éƒ½å¾¡è‹‘', action: 'æ‚ é–’æ•£æ­¥', transport: 'æ­¥è¡Œ', note: 'å°±åœ¨è»Šç«™æ—ï¼Œéå¸¸è¿‘ã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Marutamachi+Station&destination=Kyoto+Gyoen+National+Garden&travelmode=walking' },
            { id: 19, time: '18:00', location: 'å‰å¾€å››æ¢çƒä¸¸/éŒ¦å¸‚å ´', action: 'æ™šé¤', transport: 'åœ°éµçƒä¸¸ç·š', note: 'æ­ä¸€ç«™åˆ°ã€Œçƒä¸¸å¾¡æ± ã€æˆ–ã€Œå››æ¢ã€çš†å¯ã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Marutamachi+Station&destination=Nishiki+Market&travelmode=transit' }
        ],
        3: [
            { id: 20, time: '08:00', location: 'ä¸¸å¤ªç”º â†’ ä¼è¦‹ç¨»è·', action: 'å‰å¾€åƒæœ¬é³¥å±…', transport: 'åœ°éµè‡³äº¬éƒ½ç«™ + JRå¥ˆè‰¯ç·š', note: 'âš ï¸ JRè½‰ä¹˜æ³¨æ„ï¼šä¸€å®šè¦æ­ã€Œæ™®é€šã€è»Šï¼æœˆå°åœ¨8-10è™Ÿã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Marutamachi+Station&destination=Fushimi+Inari+Taisha&travelmode=transit' },
            { id: 21, time: '11:00', location: 'ä¼è¦‹ç¨»è· â†’ æ¸…æ°´å¯º', action: 'å…¬è»Šç§»å‹•', transport: 'JRå›äº¬éƒ½ç«™ + å·´å£«(206è™Ÿ)', note: 'å›äº¬éƒ½ç«™D2æœˆå°ï¼Œæ­206æˆ–86è™Ÿè‡³ã€Œäº”æ¡å‚ã€ã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Inari+Station&destination=Kiyomizu-dera&travelmode=transit' },
            { id: 24, time: '16:00', location: 'æ¸…æ°´å¯º â†’ ç¥‡åœ’', action: 'ä¸‹å¡æ•£æ­¥', transport: 'æ­¥è¡Œ', note: 'æ²¿è‘—ä¸‰å¹´å‚ã€äºŒå¹´å‚ä¸€è·¯èµ°åˆ°å…«å‚ç¥ç¤¾ã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Kiyomizu-dera&destination=Gion&travelmode=walking' },
            { id: 25, time: '18:00', location: 'æ²³åŸç”º â†’ ä¸¸å¤ªç”º(é£¯åº—)', action: 'å›ç¨‹', transport: 'å·´å£« æˆ– åœ°éµ', note: 'è‹¥åœ¨æ²³åŸç”ºï¼Œå¯æ­å…¬è»Šç›´æ¥å›ä¸¸å¤ªç”ºï¼Œæˆ–èµ°å»å¸‚å½¹æ‰€æ­åœ°éµã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Kyoto+Kawaramachi+Station&destination=Marutamachi+Station&travelmode=transit' }
        ],
        4: [
            { id: 28, time: '08:00', location: 'é£¯åº— â†’ äº¬éƒ½ç«™', action: 'å‰å¾€è»Šç«™', transport: 'åœ°éµçƒä¸¸ç·š', note: 'è¡Œæå¤šå»ºè­°é ç•™æ™‚é–“ã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Marutamachi+Station&destination=Kyoto+Station&travelmode=transit' },
            { id: 29, time: '08:30', location: 'äº¬éƒ½ç«™ â†’ é—œè¥¿æ©Ÿå ´', action: 'æ­ä¹˜ Haruka', transport: 'JR ç‰¹æ€¥ Haruka', note: 'âš ï¸ 30è™Ÿæœˆå° (å…¥ç«™å¾Œå³è½‰èµ°åˆ°åº•)ã€‚æ†‘è­·ç…§å»ç¶ è‰²æ©Ÿå™¨è²·ç¥¨ã€‚', link: 'https://www.google.com/maps/dir/?api=1&origin=Kyoto+Station&destination=Kansai+International+Airport&travelmode=transit' },
            { id: 31, time: '12:00', location: 'å›ç¨‹', action: 'é£›æ©Ÿèµ·é£›', transport: 'é£›æ©Ÿ', note: 'Safe flight!' }
        ]
    };

    const app = createApp({
        data() {
            return {
                currentDay: 0,
                currentView: 'list',
                showModal: false,
                isEditing: false,
                mapInstance: null,
                days: [
                    { shortName: 'Day 1 (äº”)', name: 'Day 1: æŠµé”å¤§é˜ª', desc: 'æ©Ÿå ´ç‰¹æ€¥ â†’ é›£æ³¢', center: [34.6655, 135.5015] },
                    { shortName: 'Day 2 (å…­)', name: 'Day 2: ç¥æˆ¶ä¸€æ—¥', desc: 'ç¥æˆ¶ç‰› â†’ æ¸¯å£å¤œæ™¯', center: [34.6946, 135.1954] },
                    { shortName: 'Day 3 (æ—¥)', name: 'Day 3: ç§»å‹•äº¬éƒ½', desc: 'å¤§é­”ç‹è½‰è»Šé—œå¡', center: [35.0163, 135.7592] },
                    { shortName: 'Day 4 (ä¸€)', name: 'Day 4: äº¬éƒ½å·¡ç¦®', desc: 'ä¼è¦‹ç¨»è· â†’ æ¸…æ°´å¯º', center: [34.9949, 135.7850] },
                    { shortName: 'Day 5 (äºŒ)', name: 'Day 5: è¿”ç¨‹', desc: 'Haruka ç›´é”æ©Ÿå ´', center: [34.4320, 135.2304] }
                ],
                activities: {},
                form: { id: null, time: '', location: '', action: '', transport: '', note: '', link: '' }
            }
        },
        computed: {
            currentActivities() {
                return this.activities[this.currentDay] || [];
            },
            sortedActivities() {
                return [...this.currentActivities].sort((a, b) => a.time.localeCompare(b.time));
            }
        },
        mounted() {
            this.loadAndMergeData();
        },
        methods: {
            loadAndMergeData() {
                // ç‚ºäº†ç¢ºä¿æ‚¨èƒ½çœ‹åˆ°æœ€æ–°çš„ã€Œå…¨è·¯ç·šå°èˆªã€è³‡æ–™ï¼Œ
                // é€™è£¡æœƒæª¢æŸ¥è³‡æ–™ç‰ˆæœ¬ï¼Œè‹¥èˆŠè³‡æ–™ç¼ºå°‘ link æ¬„ä½ï¼Œå»ºè­°åœ¨ console åŸ·è¡Œ localStorage.clear() æˆ–æ‰‹å‹•é‡ç½®
                // é è¨­è¡Œç‚ºï¼šè‹¥ç„¡è³‡æ–™å‰‡è¼‰å…¥æ–°çš„ detailedData
                try {
                    const saved = localStorage.getItem('japanTrip_v5_fullmap');
                    if (saved) {
                        this.activities = JSON.parse(saved);
                    } else {
                        this.activities = JSON.parse(JSON.stringify(detailedData));
                        this.saveToStorage();
                    }
                } catch(e) {
                    this.activities = JSON.parse(JSON.stringify(detailedData));
                }
            },
            changeDay(index) {
                this.currentDay = index;
                this.currentView = 'list';
            },
            switchMap() {
                this.currentView = 'map';
                this.$nextTick(() => {
                    if (!this.mapInstance) this.initMap();
                    setTimeout(() => {
                        this.mapInstance.invalidateSize();
                        this.mapInstance.setView(this.days[this.currentDay].center, 13);
                    }, 100);
                });
            },
            initMap() {
                this.mapInstance = L.map('map').setView(this.days[this.currentDay].center, 13);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                    attribution: 'OpenStreetMap', maxZoom: 19
                }).addTo(this.mapInstance);
            },
            openSmartMap(item) {
                if (item.link) {
                    window.open(item.link, '_blank');
                } else {
                    window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.location)}`, '_blank');
                }
            },
            openModal(item = null) {
                this.isEditing = !!item;
                this.form = item ? { ...item } : { id: Date.now(), time: '09:00', location: '', action: '', transport: '', note: '', link: '' };
                this.showModal = true;
            },
            saveActivity() {
                if (!this.form.location) return alert('è«‹è¼¸å…¥åœ°é»');
                if (!this.activities[this.currentDay]) this.activities[this.currentDay] = [];
                
                if (this.isEditing) {
                    const idx = this.activities[this.currentDay].findIndex(x => x.id === this.form.id);
                    if (idx !== -1) this.activities[this.currentDay][idx] = { ...this.form };
                } else {
                    this.activities[this.currentDay].push({ ...this.form });
                }
                this.saveToStorage();
                this.showModal = false;
            },
            deleteActivity() {
                if(confirm('åˆªé™¤æ­¤è¡Œç¨‹ï¼Ÿ')) {
                    this.activities[this.currentDay] = this.activities[this.currentDay].filter(x => x.id !== this.form.id);
                    this.saveToStorage();
                    this.showModal = false;
                }
            },
            saveToStorage() {
                localStorage.setItem('japanTrip_v5_fullmap', JSON.stringify(this.activities));
            },
            resetData() {
                if(confirm('ç¢ºå®šè¦é‡ç½®ç‚ºé è¨­è¡Œç¨‹å—ï¼Ÿæ‚¨çš„è‡ªè¨‚ä¿®æ”¹å°‡æœƒæ¶ˆå¤±ã€‚')) {
                    this.activities = JSON.parse(JSON.stringify(detailedData));
                    this.saveToStorage();
                    this.currentDay = 0;
                    alert('è¡Œç¨‹å·²æ›´æ–°ç‚ºå…¨è·¯ç·šå°èˆªç‰ˆï¼');
                }
            }
        }
    });
    
    app.mount('#app');
</script>

<style>
@keyframes bounce-up { 0% { transform: translateY(20px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
.animate-bounce-up { animation: bounce-up 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
</style>

</body>
</html>
